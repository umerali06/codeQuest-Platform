<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learning Path Flow Test - CodeQuest</title>
    <link rel="stylesheet" href="public/styles.css" />
    <link rel="stylesheet" href="public/learn-styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        background: var(--darker);
        color: var(--light);
        font-family: "Inter", sans-serif;
        margin: 0;
        padding: 2rem 0;
      }
      .test-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
      }
      .test-title {
        text-align: center;
        margin-bottom: 2rem;
        color: var(--light);
      }
      .test-section {
        margin-bottom: 3rem;
      }
      .demo-controls {
        text-align: center;
        margin-bottom: 2rem;
        padding: 1rem;
        background: rgba(99, 102, 241, 0.1);
        border-radius: 0.5rem;
        border: 1px solid rgba(99, 102, 241, 0.3);
      }
      .demo-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        cursor: pointer;
        margin: 0.25rem;
        transition: all 0.3s ease;
      }
      .demo-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
      }
      .demo-btn.secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .demo-btn.secondary:hover {
        background: rgba(255, 255, 255, 0.15);
      }
      .current-view {
        font-weight: 600;
        color: var(--primary);
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1 class="test-title">Learning Path Flow Demonstration</h1>

      <div class="demo-controls">
        <p>
          <strong>Current View:</strong>
          <span id="currentView" class="current-view"
            >Learning Paths Overview</span
          >
        </p>
        <button class="demo-btn" onclick="showPathsView()">
          Show Learning Paths
        </button>
        <button class="demo-btn" onclick="showFrontendModules()">
          Frontend Modules
        </button>
        <button class="demo-btn" onclick="showBackendModules()">
          Backend Modules
        </button>
        <button class="demo-btn secondary" onclick="simulateProgress()">
          Simulate Progress
        </button>
        <button class="demo-btn secondary" onclick="resetProgress()">
          Reset Progress
        </button>
      </div>

      <!-- Learning Paths View -->
      <div id="pathsView" class="test-section">
        <section class="learning-paths-section">
          <div class="container">
            <div class="section-header">
              <h2>Learning Paths</h2>
              <p>Structured roadmaps to guide your learning journey</p>
            </div>
            <div class="paths-container" id="pathsContainer">
              <!-- Paths will be rendered here -->
            </div>
          </div>
        </section>
      </div>

      <!-- Path Modules View -->
      <div id="modulesView" class="test-section" style="display: none">
        <div class="container">
          <button
            class="btn btn-secondary path-back-btn"
            onclick="showPathsView()"
            style="margin-bottom: 2rem"
          >
            <i class="fas fa-arrow-left"></i> Back to Learning Paths
          </button>

          <div class="path-detail-header" id="pathDetailHeader">
            <!-- Path header will be rendered here -->
          </div>

          <div class="path-modules-grid" id="pathModulesGrid">
            <!-- Modules will be rendered here -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // Demo data
      let pathsData = {
        "frontend-development": {
          id: "frontend-development",
          title: "Frontend Development",
          description:
            "Master HTML, CSS, JavaScript and modern frameworks to build beautiful, interactive websites.",
          icon: "fas fa-paint-brush",
          color: "#f59e0b",
          estimated_hours: 120,
          total_modules: 8,
          progress_percentage: 0,
          completed_modules: 0,
          status: "not_started",
          modules: [
            {
              id: "html-basics",
              title: "HTML Fundamentals",
              description:
                "Learn the building blocks of web pages with HTML elements and structure.",
              icon: "ðŸ—ï¸",
              difficulty: "beginner",
              lesson_count: 12,
              estimated_hours: 15,
              total_xp: 120,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "css-styling",
              title: "CSS Styling",
              description:
                "Style your web pages with colors, layouts, and responsive design.",
              icon: "ðŸŽ¨",
              difficulty: "beginner",
              lesson_count: 15,
              estimated_hours: 18,
              total_xp: 150,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "javascript-basics",
              title: "JavaScript Fundamentals",
              description:
                "Add interactivity to your websites with JavaScript programming.",
              icon: "âš¡",
              difficulty: "intermediate",
              lesson_count: 20,
              estimated_hours: 25,
              total_xp: 200,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "dom-manipulation",
              title: "DOM Manipulation",
              description:
                "Learn to dynamically modify web pages using JavaScript.",
              icon: "ðŸ”§",
              difficulty: "intermediate",
              lesson_count: 10,
              estimated_hours: 12,
              total_xp: 100,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "responsive-design",
              title: "Responsive Design",
              description:
                "Create websites that work perfectly on all devices.",
              icon: "ðŸ“±",
              difficulty: "intermediate",
              lesson_count: 8,
              estimated_hours: 10,
              total_xp: 80,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "modern-css",
              title: "Modern CSS",
              description: "Master Flexbox, Grid, and advanced CSS techniques.",
              icon: "ðŸŽ¯",
              difficulty: "advanced",
              lesson_count: 12,
              estimated_hours: 15,
              total_xp: 120,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "react-basics",
              title: "React Fundamentals",
              description:
                "Build dynamic user interfaces with React components.",
              icon: "âš›ï¸",
              difficulty: "advanced",
              lesson_count: 18,
              estimated_hours: 22,
              total_xp: 180,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "frontend-project",
              title: "Frontend Portfolio Project",
              description:
                "Build a complete portfolio website showcasing your skills.",
              icon: "ðŸš€",
              difficulty: "advanced",
              lesson_count: 5,
              estimated_hours: 8,
              total_xp: 200,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
          ],
        },
        "backend-development": {
          id: "backend-development",
          title: "Backend Development",
          description:
            "Learn server-side programming, databases, APIs and authentication to power your applications.",
          icon: "fas fa-server",
          color: "#10b981",
          estimated_hours: 90,
          total_modules: 6,
          progress_percentage: 0,
          completed_modules: 0,
          status: "not_started",
          modules: [
            {
              id: "nodejs-basics",
              title: "Node.js Fundamentals",
              description: "Learn server-side JavaScript with Node.js runtime.",
              icon: "ðŸŸ¢",
              difficulty: "intermediate",
              lesson_count: 15,
              estimated_hours: 18,
              total_xp: 150,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "express-framework",
              title: "Express.js Framework",
              description: "Build web servers and APIs with Express.js.",
              icon: "ðŸš‚",
              difficulty: "intermediate",
              lesson_count: 12,
              estimated_hours: 15,
              total_xp: 120,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "database-design",
              title: "Database Design",
              description: "Design and work with SQL and NoSQL databases.",
              icon: "ðŸ—„ï¸",
              difficulty: "intermediate",
              lesson_count: 10,
              estimated_hours: 12,
              total_xp: 100,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "api-development",
              title: "REST API Development",
              description:
                "Create robust APIs for web and mobile applications.",
              icon: "ðŸ”Œ",
              difficulty: "advanced",
              lesson_count: 14,
              estimated_hours: 16,
              total_xp: 140,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "authentication",
              title: "Authentication & Security",
              description:
                "Implement secure user authentication and authorization.",
              icon: "ðŸ”",
              difficulty: "advanced",
              lesson_count: 8,
              estimated_hours: 10,
              total_xp: 80,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
            {
              id: "backend-project",
              title: "Full-Stack API Project",
              description: "Build a complete backend API with authentication.",
              icon: "ðŸ—ï¸",
              difficulty: "advanced",
              lesson_count: 6,
              estimated_hours: 12,
              total_xp: 200,
              user_progress: {
                progress_percentage: 0,
                is_started: false,
                is_completed: false,
              },
            },
          ],
        },
      };

      let currentPath = null;

      // Initialize view
      function init() {
        renderPaths();
      }

      function renderPaths() {
        const container = document.getElementById("pathsContainer");
        const paths = Object.values(pathsData);

        container.innerHTML = paths
          .map((path) => renderPathCard(path))
          .join("");
      }

      function renderPathCard(path) {
        let buttonText = "Start Path";
        let buttonClass = "btn-secondary";

        if (path.status === "completed") {
          buttonText = "Review Path";
          buttonClass = "btn-success";
        } else if (path.status === "in_progress") {
          buttonText = "Continue Path";
          buttonClass = "btn-primary";
        }

        return `
                <div class="path-card ${path.id}">
                    <div class="path-header">
                        <div class="path-icon" style="background: linear-gradient(135deg, ${
                          path.color
                        }, ${adjustColor(path.color, -20)});">
                            <i class="${path.icon}"></i>
                        </div>
                        <h3>${path.title}</h3>
                    </div>
                    <p>${path.description}</p>
                    <div class="path-stats">
                        <span><i class="fas fa-clock"></i> ${
                          path.estimated_hours
                        } hours</span>
                        <span><i class="fas fa-graduation-cap"></i> ${
                          path.total_modules
                        } modules</span>
                    </div>
                    ${
                      path.progress_percentage > 0
                        ? `
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${
                                  path.progress_percentage
                                }%"></div>
                            </div>
                            <span>${Math.round(
                              path.progress_percentage
                            )}% complete</span>
                        </div>
                    `
                        : ""
                    }
                    <button class="btn ${buttonClass}" onclick="startPath('${
          path.id
        }')">
                        ${buttonText}
                    </button>
                </div>
            `;
      }

      function adjustColor(color, amount) {
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * amount);
        const R = (num >> 16) + amt;
        const G = ((num >> 8) & 0x00ff) + amt;
        const B = (num & 0x0000ff) + amt;
        return (
          "#" +
          (
            0x1000000 +
            (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
            (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
            (B < 255 ? (B < 1 ? 0 : B) : 255)
          )
            .toString(16)
            .slice(1)
        );
      }

      function startPath(pathId) {
        currentPath = pathsData[pathId];
        showPathModules(pathId);
      }

      function showPathModules(pathId) {
        const path = pathsData[pathId];
        currentPath = path;

        // Update path status
        if (path.status === "not_started") {
          path.status = "in_progress";
          showNotification(
            "Successfully enrolled in learning path!",
            "success"
          );
        }

        // Update current view
        document.getElementById(
          "currentView"
        ).textContent = `${path.title} Modules`;

        // Show modules view
        document.getElementById("pathsView").style.display = "none";
        document.getElementById("modulesView").style.display = "block";

        // Render path header
        renderPathHeader(path);

        // Render modules
        renderPathModules(path);
      }

      function renderPathHeader(path) {
        const header = document.getElementById("pathDetailHeader");
        header.innerHTML = `
                <div class="path-detail-icon" style="background: linear-gradient(135deg, ${
                  path.color
                }, ${adjustColor(path.color, -20)});">
                    <i class="${path.icon}"></i>
                </div>
                <div class="path-detail-info">
                    <h1>${path.title}</h1>
                    <p>${path.description}</p>
                    <div class="path-detail-stats">
                        <div class="detail-stat">
                            <i class="fas fa-graduation-cap"></i>
                            <span>${path.modules.length} modules</span>
                        </div>
                        <div class="detail-stat">
                            <i class="fas fa-clock"></i>
                            <span>${path.estimated_hours} hours</span>
                        </div>
                        <div class="detail-stat">
                            <i class="fas fa-chart-line"></i>
                            <span>${Math.round(
                              path.progress_percentage
                            )}% complete</span>
                        </div>
                        <div class="detail-stat">
                            <i class="fas fa-star"></i>
                            <span>${calculateEarnedXP(path)} XP earned</span>
                        </div>
                    </div>
                    ${
                      path.progress_percentage > 0
                        ? `
                        <div class="path-progress-detail">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${
                                  path.progress_percentage
                                }%"></div>
                            </div>
                            <span>${Math.round(
                              path.progress_percentage
                            )}% complete (${path.completed_modules}/${
                            path.total_modules
                          } modules)</span>
                        </div>
                    `
                        : ""
                    }
                </div>
            `;
      }

      function renderPathModules(path) {
        const grid = document.getElementById("pathModulesGrid");
        grid.innerHTML = path.modules
          .map((module, index) => renderModuleCard(module, index + 1))
          .join("");
      }

      function renderModuleCard(module, order) {
        const progress = module.user_progress;
        let actionButton = "";
        let statusClass = "";
        let statusIcon = "";

        if (progress.is_completed) {
          actionButton = `<button class="module-btn completed" onclick="reviewModule('${module.id}')">
                    <i class="fas fa-check-circle"></i> Review Module
                </button>`;
          statusClass = "completed";
          statusIcon =
            '<i class="fas fa-check-circle module-status-icon completed"></i>';
        } else if (progress.is_started) {
          actionButton = `<button class="module-btn primary" onclick="continueModule('${module.id}')">
                    <i class="fas fa-play"></i> Continue Learning
                </button>`;
          statusClass = "in-progress";
          statusIcon =
            '<i class="fas fa-play-circle module-status-icon in-progress"></i>';
        } else {
          actionButton = `<button class="module-btn primary" onclick="startModule('${module.id}')">
                    <i class="fas fa-rocket"></i> Start Module
                </button>`;
          statusClass = "not-started";
          statusIcon = '<i class="fas fa-lock module-status-icon locked"></i>';
        }

        return `
                <div class="path-module-card ${statusClass}" data-module-id="${
          module.id
        }">
                    <div class="module-order">${order}</div>
                    ${statusIcon}
                    
                    <div class="module-header">
                        <div class="module-icon">
                            ${module.icon}
                        </div>
                        <div class="module-info">
                            <h3>${module.title}</h3>
                            <div class="module-difficulty ${module.difficulty}">
                                ${
                                  module.difficulty.charAt(0).toUpperCase() +
                                  module.difficulty.slice(1)
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div class="module-description">
                        ${module.description}
                    </div>
                    
                    <div class="module-stats">
                        <div class="module-stat">
                            <i class="fas fa-book"></i>
                            <span>${module.lesson_count} lessons</span>
                        </div>
                        <div class="module-stat">
                            <i class="fas fa-clock"></i>
                            <span>${module.estimated_hours}h</span>
                        </div>
                        <div class="module-stat">
                            <i class="fas fa-star"></i>
                            <span>${module.total_xp} XP</span>
                        </div>
                    </div>
                    
                    ${
                      progress.progress_percentage > 0
                        ? `
                        <div class="module-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${
                                  progress.progress_percentage
                                }%"></div>
                            </div>
                            <div class="progress-text">
                                <span>${
                                  progress.progress_percentage
                                }% complete</span>
                                <span>${Math.round(
                                  (progress.progress_percentage *
                                    module.lesson_count) /
                                    100
                                )}/${module.lesson_count} lessons</span>
                            </div>
                        </div>
                    `
                        : ""
                    }
                    
                    <div class="module-actions">
                        ${actionButton}
                    </div>
                </div>
            `;
      }

      function startModule(moduleId) {
        const module = findModule(moduleId);
        if (module) {
          module.user_progress.is_started = true;
          module.user_progress.progress_percentage = 25;
          updatePathProgress();
          showNotification(`Started ${module.title}!`, "success");
          renderPathModules(currentPath);
          renderPathHeader(currentPath);
        }
      }

      function continueModule(moduleId) {
        const module = findModule(moduleId);
        if (module) {
          module.user_progress.progress_percentage = Math.min(
            100,
            module.user_progress.progress_percentage + 25
          );
          if (module.user_progress.progress_percentage >= 100) {
            module.user_progress.is_completed = true;
          }
          updatePathProgress();
          showNotification(`Progress updated for ${module.title}!`, "success");
          renderPathModules(currentPath);
          renderPathHeader(currentPath);
        }
      }

      function reviewModule(moduleId) {
        const module = findModule(moduleId);
        if (module) {
          showNotification(`Reviewing ${module.title}`, "info");
        }
      }

      function findModule(moduleId) {
        if (!currentPath) return null;
        return currentPath.modules.find((m) => m.id === moduleId);
      }

      function updatePathProgress() {
        if (!currentPath) return;

        const completedModules = currentPath.modules.filter(
          (m) => m.user_progress.is_completed
        ).length;
        const totalModules = currentPath.modules.length;

        currentPath.completed_modules = completedModules;
        currentPath.progress_percentage = Math.round(
          (completedModules / totalModules) * 100
        );

        if (currentPath.progress_percentage >= 100) {
          currentPath.status = "completed";
        } else if (currentPath.progress_percentage > 0) {
          currentPath.status = "in_progress";
        }
      }

      function calculateEarnedXP(path) {
        return path.modules
          .filter((m) => m.user_progress.is_completed)
          .reduce((sum, m) => sum + m.total_xp, 0);
      }

      function showPathsView() {
        document.getElementById("currentView").textContent =
          "Learning Paths Overview";
        document.getElementById("pathsView").style.display = "block";
        document.getElementById("modulesView").style.display = "none";
        currentPath = null;
        renderPaths();
      }

      function showFrontendModules() {
        showPathModules("frontend-development");
      }

      function showBackendModules() {
        showPathModules("backend-development");
      }

      function simulateProgress() {
        // Simulate some progress on frontend path
        const frontendPath = pathsData["frontend-development"];
        frontendPath.modules[0].user_progress = {
          progress_percentage: 100,
          is_started: true,
          is_completed: true,
        };
        frontendPath.modules[1].user_progress = {
          progress_percentage: 75,
          is_started: true,
          is_completed: false,
        };
        frontendPath.modules[2].user_progress = {
          progress_percentage: 25,
          is_started: true,
          is_completed: false,
        };

        // Update path progress
        const completedModules = frontendPath.modules.filter(
          (m) => m.user_progress.is_completed
        ).length;
        frontendPath.completed_modules = completedModules;
        frontendPath.progress_percentage = Math.round(
          (completedModules / frontendPath.modules.length) * 100
        );
        frontendPath.status = "in_progress";

        showNotification("Simulated progress added!", "success");

        if (currentPath && currentPath.id === "frontend-development") {
          renderPathModules(currentPath);
          renderPathHeader(currentPath);
        } else {
          renderPaths();
        }
      }

      function resetProgress() {
        // Reset all progress
        Object.values(pathsData).forEach((path) => {
          path.progress_percentage = 0;
          path.completed_modules = 0;
          path.status = "not_started";
          path.modules.forEach((module) => {
            module.user_progress = {
              progress_percentage: 0,
              is_started: false,
              is_completed: false,
            };
          });
        });

        showNotification("All progress reset!", "info");

        if (currentPath) {
          renderPathModules(currentPath);
          renderPathHeader(currentPath);
        } else {
          renderPaths();
        }
      }

      function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${
                  type === "error"
                    ? "#ef4444"
                    : type === "success"
                    ? "#22c55e"
                    : "#3b82f6"
                };
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            `;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.remove();
        }, 3000);
      }

      // Add CSS animation
      const style = document.createElement("style");
      style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
      document.head.appendChild(style);

      // Initialize
      init();
    </script>
  </body>
</html>
