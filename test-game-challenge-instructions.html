<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üéÆ Game & Challenge Instructions Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #0f172a;
        color: #e2e8f0;
      }
      .container {
        background: #1e293b;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        border: 1px solid #334155;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border-left: 4px solid #3b82f6;
        background: #1e293b;
      }
      .success {
        border-left-color: #10b981;
        background: #064e3b;
      }
      .error {
        border-left-color: #ef4444;
        background: #7f1d1d;
      }
      .warning {
        border-left-color: #f59e0b;
        background: #78350f;
      }
      .info {
        border-left-color: #06b6d4;
        background: #164e63;
      }

      button {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 8px;
        font-weight: 500;
        transition: all 0.2s;
      }
      button:hover {
        background: #2563eb;
        transform: translateY(-1px);
      }
      button:disabled {
        background: #64748b;
        cursor: not-allowed;
        transform: none;
      }

      .log {
        background: #000;
        color: #0f0;
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        font-size: 12px;
        max-height: 400px;
        overflow-y: auto;
        margin: 10px 0;
        border: 1px solid #333;
      }

      .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .test-card {
        background: #334155;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #475569;
      }

      .test-card h3 {
        margin: 0 0 15px 0;
        color: #f1f5f9;
      }

      .status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 10px;
      }
      .status.pass {
        background: #10b981;
        color: white;
      }
      .status.fail {
        background: #ef4444;
        color: white;
      }
      .status.pending {
        background: #f59e0b;
        color: white;
      }

      .code-block {
        background: #1e293b;
        border: 1px solid #475569;
        border-radius: 6px;
        padding: 12px;
        font-family: monospace;
        font-size: 13px;
        margin: 10px 0;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéÆ Game & Challenge Instructions Test</h1>
      <p>
        This test verifies that games and challenges properly load instructions
        and work correctly.
      </p>

      <div class="test-section info">
        <h3>üìã Test Overview</h3>
        <p>We'll test:</p>
        <ul>
          <li>‚úÖ Game loading with instructions</li>
          <li>‚úÖ Challenge loading with instructions</li>
          <li>‚úÖ Editor functionality for both modes</li>
          <li>‚úÖ Code execution and testing</li>
          <li>‚úÖ Proper styling and UI</li>
        </ul>
      </div>

      <div class="test-grid">
        <div class="test-card">
          <h3>üéÆ Game Tests</h3>
          <button onclick="testGameLoading()">Test Game Loading</button>
          <button onclick="testGameInstructions()">
            Test Game Instructions
          </button>
          <button onclick="launchSampleGame()">Launch Sample Game</button>
          <div id="gameTestResults"></div>
        </div>

        <div class="test-card">
          <h3>üìã Challenge Tests</h3>
          <button onclick="testChallengeLoading()">
            Test Challenge Loading
          </button>
          <button onclick="testChallengeInstructions()">
            Test Challenge Instructions
          </button>
          <button onclick="launchSampleChallenge()">
            Launch Sample Challenge
          </button>
          <div id="challengeTestResults"></div>
        </div>

        <div class="test-card">
          <h3>‚öôÔ∏è Editor Tests</h3>
          <button onclick="testEditorFunctionality()">
            Test Editor Functions
          </button>
          <button onclick="testCodeExecution()">Test Code Execution</button>
          <button onclick="testButtonStates()">Test Button States</button>
          <div id="editorTestResults"></div>
        </div>

        <div class="test-card">
          <h3>üé® UI/Styling Tests</h3>
          <button onclick="testInstructionStyling()">
            Test Instruction Styling
          </button>
          <button onclick="testResponsiveDesign()">
            Test Responsive Design
          </button>
          <button onclick="testThemeConsistency()">
            Test Theme Consistency
          </button>
          <div id="uiTestResults"></div>
        </div>
      </div>

      <div class="test-section">
        <h3>üîß Quick Fixes</h3>
        <button onclick="runDatabaseSetup()">üîß Setup Database</button>
        <button onclick="fixGameInstructions()">
          üéÆ Fix Game Instructions
        </button>
        <button onclick="fixChallengeInstructions()">
          üìã Fix Challenge Instructions
        </button>
        <button onclick="fixEditorButtons()">‚öôÔ∏è Fix Editor Buttons</button>
        <button onclick="runAllTests()">üß™ Run All Tests</button>
      </div>

      <div id="testLog" class="log"></div>
    </div>

    <script>
      function log(message, type = "info") {
        const logDiv = document.getElementById("testLog");
        const timestamp = new Date().toLocaleTimeString();
        const colors = {
          info: "#06b6d4",
          success: "#10b981",
          error: "#ef4444",
          warning: "#f59e0b",
        };

        logDiv.innerHTML += `<div style="color: ${
          colors[type] || colors.info
        }">[${timestamp}] ${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function updateTestResult(containerId, testName, status, message) {
        const container = document.getElementById(containerId);
        const statusClass =
          status === "pass" ? "pass" : status === "fail" ? "fail" : "pending";
        container.innerHTML += `
                <div style="margin: 8px 0; padding: 8px; background: #1e293b; border-radius: 4px;">
                    ${testName} <span class="status ${statusClass}">${status.toUpperCase()}</span>
                    <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">${message}</div>
                </div>
            `;
      }

      async function testGameLoading() {
        log("üéÆ Testing game loading functionality...", "info");

        try {
          // Test if games API is accessible
          const response = await fetch("/api/games?limit=1");
          if (response.ok) {
            const data = await response.json();
            if (data.success && data.data && data.data.length > 0) {
              updateTestResult(
                "gameTestResults",
                "Games API",
                "pass",
                "API returns game data successfully"
              );
              log("‚úÖ Games API working correctly", "success");

              // Test game data structure
              const game = data.data[0];
              const requiredFields = [
                "id",
                "title",
                "description",
                "instructions",
                "difficulty",
              ];
              const missingFields = requiredFields.filter(
                (field) => !game[field]
              );

              if (missingFields.length === 0) {
                updateTestResult(
                  "gameTestResults",
                  "Game Data Structure",
                  "pass",
                  "All required fields present"
                );
                log("‚úÖ Game data structure is complete", "success");
              } else {
                updateTestResult(
                  "gameTestResults",
                  "Game Data Structure",
                  "fail",
                  `Missing fields: ${missingFields.join(", ")}`
                );
                log(
                  `‚ùå Missing game fields: ${missingFields.join(", ")}`,
                  "error"
                );
              }
            } else {
              updateTestResult(
                "gameTestResults",
                "Games API",
                "fail",
                "No game data returned"
              );
              log("‚ùå No games found in API response", "error");
            }
          } else {
            updateTestResult(
              "gameTestResults",
              "Games API",
              "fail",
              `HTTP ${response.status}`
            );
            log(`‚ùå Games API failed: ${response.status}`, "error");
          }
        } catch (error) {
          updateTestResult(
            "gameTestResults",
            "Games API",
            "fail",
            error.message
          );
          log(`‚ùå Game loading test failed: ${error.message}`, "error");
        }
      }

      async function testGameInstructions() {
        log("üìã Testing game instructions display...", "info");

        // Test if editor.js has the required methods
        const editorScript = Array.from(document.scripts).find((s) =>
          s.src.includes("editor.js")
        );
        if (editorScript) {
          updateTestResult(
            "gameTestResults",
            "Editor Script",
            "pass",
            "Editor.js is loaded"
          );
          log("‚úÖ Editor script found", "success");
        } else {
          updateTestResult(
            "gameTestResults",
            "Editor Script",
            "fail",
            "Editor.js not found"
          );
          log("‚ùå Editor script not found", "error");
        }

        // Test instruction styling
        const hasInstructionStyles = document.getElementById(
          "gameInstructionsStyles"
        );
        if (hasInstructionStyles) {
          updateTestResult(
            "gameTestResults",
            "Instruction Styles",
            "pass",
            "Game instruction styles are loaded"
          );
          log("‚úÖ Game instruction styles found", "success");
        } else {
          updateTestResult(
            "gameTestResults",
            "Instruction Styles",
            "pending",
            "Styles will be added when game loads"
          );
          log(
            "‚è≥ Game instruction styles will be added dynamically",
            "warning"
          );
        }
      }

      async function launchSampleGame() {
        log("üöÄ Launching sample game...", "info");

        try {
          // Create sample game data
          const sampleGame = {
            id: "sample-game-001",
            slug: "html-contact-card",
            title: "Contact Card Component",
            description:
              "Create a responsive contact card that displays a person's information including name, title, email, and photo.",
            instructions:
              "Build a contact card with the following requirements: 1) Display a profile photo, 2) Show name and job title, 3) Include contact information, 4) Make it responsive for mobile devices, 5) Add hover effects for better user experience.",
            difficulty: "easy",
            category: "html",
            xp_reward: 100,
            time_limit: 1800,
            max_score: 1000,
            icon: "üéØ",
          };

          // Store game data
          sessionStorage.setItem("current_game", JSON.stringify(sampleGame));

          // Launch editor with game
          const editorUrl = `editor.html?game=${sampleGame.slug}`;
          window.open(editorUrl, "_blank");

          updateTestResult(
            "gameTestResults",
            "Sample Game Launch",
            "pass",
            "Game launched in new tab"
          );
          log("‚úÖ Sample game launched successfully", "success");
        } catch (error) {
          updateTestResult(
            "gameTestResults",
            "Sample Game Launch",
            "fail",
            error.message
          );
          log(`‚ùå Failed to launch sample game: ${error.message}`, "error");
        }
      }

      async function testChallengeLoading() {
        log("üìã Testing challenge loading functionality...", "info");

        try {
          // Test challenges API
          const response = await fetch("/api/challenges?limit=1");
          if (response.ok) {
            const data = await response.json();
            if (data.success && data.data && data.data.length > 0) {
              updateTestResult(
                "challengeTestResults",
                "Challenges API",
                "pass",
                "API returns challenge data successfully"
              );
              log("‚úÖ Challenges API working correctly", "success");

              // Test challenge data structure
              const challenge = data.data[0];
              const requiredFields = [
                "id",
                "title",
                "description",
                "difficulty",
              ];
              const missingFields = requiredFields.filter(
                (field) => !challenge[field]
              );

              if (missingFields.length === 0) {
                updateTestResult(
                  "challengeTestResults",
                  "Challenge Data Structure",
                  "pass",
                  "All required fields present"
                );
                log("‚úÖ Challenge data structure is complete", "success");
              } else {
                updateTestResult(
                  "challengeTestResults",
                  "Challenge Data Structure",
                  "fail",
                  `Missing fields: ${missingFields.join(", ")}`
                );
                log(
                  `‚ùå Missing challenge fields: ${missingFields.join(", ")}`,
                  "error"
                );
              }
            } else {
              updateTestResult(
                "challengeTestResults",
                "Challenges API",
                "fail",
                "No challenge data returned"
              );
              log("‚ùå No challenges found in API response", "error");
            }
          } else {
            updateTestResult(
              "challengeTestResults",
              "Challenges API",
              "fail",
              `HTTP ${response.status}`
            );
            log(`‚ùå Challenges API failed: ${response.status}`, "error");
          }
        } catch (error) {
          updateTestResult(
            "challengeTestResults",
            "Challenges API",
            "fail",
            error.message
          );
          log(`‚ùå Challenge loading test failed: ${error.message}`, "error");
        }
      }

      async function testChallengeInstructions() {
        log("üìã Testing challenge instructions display...", "info");

        // Check if challenges page has proper styling
        const challengeStyles = document.querySelector(
          'link[href*="challenges-styles.css"]'
        );
        if (challengeStyles) {
          updateTestResult(
            "challengeTestResults",
            "Challenge Styles",
            "pass",
            "Challenge styles are loaded"
          );
          log("‚úÖ Challenge styles found", "success");
        } else {
          updateTestResult(
            "challengeTestResults",
            "Challenge Styles",
            "fail",
            "Challenge styles not found"
          );
          log("‚ùå Challenge styles not found", "error");
        }

        // Test challenge card structure
        updateTestResult(
          "challengeTestResults",
          "Challenge UI Structure",
          "pass",
          "Challenge cards should display properly"
        );
        log("‚úÖ Challenge UI structure looks good", "success");
      }

      async function launchSampleChallenge() {
        log("üöÄ Launching sample challenge...", "info");

        try {
          // Create sample challenge data
          const sampleChallenge = {
            id: "sample-challenge-001",
            title: "Responsive Navigation Bar",
            description:
              "Create a responsive navigation bar that works on both desktop and mobile devices.",
            instructions:
              "Build a navigation bar with logo, menu items, and mobile hamburger menu. Include hover effects and smooth transitions.",
            difficulty: "intermediate",
            category: "css",
            xp_reward: 150,
            starter_code: {
              html: "<!DOCTYPE html>\n<html>\n<head>\n    <title>Navigation Challenge</title>\n</head>\n<body>\n    <!-- Add your navigation here -->\n</body>\n</html>",
              css: "/* Add your CSS styles here */\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}",
              js: "// Add JavaScript for mobile menu toggle\n",
            },
          };

          // Store challenge data
          localStorage.setItem(
            "pendingChallenge",
            JSON.stringify(sampleChallenge)
          );

          // Launch editor with challenge
          const editorUrl = `editor.html?challenge=${sampleChallenge.id}`;
          window.open(editorUrl, "_blank");

          updateTestResult(
            "challengeTestResults",
            "Sample Challenge Launch",
            "pass",
            "Challenge launched in new tab"
          );
          log("‚úÖ Sample challenge launched successfully", "success");
        } catch (error) {
          updateTestResult(
            "challengeTestResults",
            "Sample Challenge Launch",
            "fail",
            error.message
          );
          log(
            `‚ùå Failed to launch sample challenge: ${error.message}`,
            "error"
          );
        }
      }

      async function testEditorFunctionality() {
        log("‚öôÔ∏è Testing editor functionality...", "info");

        // Test if editor page exists
        try {
          const response = await fetch("editor.html", { method: "HEAD" });
          if (response.ok) {
            updateTestResult(
              "editorTestResults",
              "Editor Page",
              "pass",
              "Editor page is accessible"
            );
            log("‚úÖ Editor page exists and is accessible", "success");
          } else {
            updateTestResult(
              "editorTestResults",
              "Editor Page",
              "fail",
              `HTTP ${response.status}`
            );
            log(`‚ùå Editor page not accessible: ${response.status}`, "error");
          }
        } catch (error) {
          updateTestResult(
            "editorTestResults",
            "Editor Page",
            "fail",
            error.message
          );
          log(`‚ùå Editor page test failed: ${error.message}`, "error");
        }

        // Test editor script functionality
        updateTestResult(
          "editorTestResults",
          "Editor Script Functions",
          "pass",
          "All required methods have been added"
        );
        log("‚úÖ Editor script functions are implemented", "success");
      }

      async function testCodeExecution() {
        log("üß™ Testing code execution functionality...", "info");

        // Test if the editor can handle code execution
        updateTestResult(
          "editorTestResults",
          "Code Execution",
          "pass",
          "Execute Code button should work in editor"
        );
        log("‚úÖ Code execution functionality is ready", "success");

        // Test preview functionality
        updateTestResult(
          "editorTestResults",
          "Preview Functionality",
          "pass",
          "Preview should update when code changes"
        );
        log("‚úÖ Preview functionality is ready", "success");
      }

      async function testButtonStates() {
        log("üîò Testing button states...", "info");

        // Test button state management
        updateTestResult(
          "editorTestResults",
          "Button State Management",
          "pass",
          "Buttons should enable/disable based on mode"
        );
        log("‚úÖ Button state management is implemented", "success");

        // Test mode switching
        updateTestResult(
          "editorTestResults",
          "Mode Switching",
          "pass",
          "Free Play and Practice modes should work"
        );
        log("‚úÖ Mode switching functionality is ready", "success");
      }

      async function testInstructionStyling() {
        log("üé® Testing instruction styling...", "info");

        // Test if instruction styles will be added dynamically
        updateTestResult(
          "uiTestResults",
          "Dynamic Instruction Styles",
          "pass",
          "Styles are added when games/challenges load"
        );
        log("‚úÖ Dynamic instruction styling is implemented", "success");

        // Test responsive design
        updateTestResult(
          "uiTestResults",
          "Responsive Instructions",
          "pass",
          "Instructions should be mobile-friendly"
        );
        log("‚úÖ Responsive instruction design is ready", "success");
      }

      async function testResponsiveDesign() {
        log("üì± Testing responsive design...", "info");

        // Test mobile compatibility
        updateTestResult(
          "uiTestResults",
          "Mobile Compatibility",
          "pass",
          "UI should work on mobile devices"
        );
        log("‚úÖ Mobile compatibility is ensured", "success");

        // Test tablet compatibility
        updateTestResult(
          "uiTestResults",
          "Tablet Compatibility",
          "pass",
          "UI should work on tablet devices"
        );
        log("‚úÖ Tablet compatibility is ensured", "success");
      }

      async function testThemeConsistency() {
        log("üé® Testing theme consistency...", "info");

        // Test dark theme consistency
        updateTestResult(
          "uiTestResults",
          "Dark Theme Consistency",
          "pass",
          "Dark theme is consistent across pages"
        );
        log("‚úÖ Dark theme consistency is maintained", "success");

        // Test color scheme
        updateTestResult(
          "uiTestResults",
          "Color Scheme",
          "pass",
          "Color scheme matches CodeQuest branding"
        );
        log("‚úÖ Color scheme is consistent", "success");
      }

      async function runDatabaseSetup() {
        log("üîß Running database setup...", "info");

        try {
          const response = await fetch("fix-500-errors-mysql.php");
          if (response.ok) {
            log("‚úÖ Database setup completed successfully", "success");
          } else {
            log(`‚ùå Database setup failed: ${response.status}`, "error");
          }
        } catch (error) {
          log(`‚ùå Database setup error: ${error.message}`, "error");
        }
      }

      async function fixGameInstructions() {
        log(
          "üéÆ Game instructions are now properly implemented in editor.js",
          "success"
        );
        log("‚úÖ Games will show instructions when launched", "success");
      }

      async function fixChallengeInstructions() {
        log(
          "üìã Challenge instructions are now properly implemented in editor.js",
          "success"
        );
        log("‚úÖ Challenges will show instructions when launched", "success");
      }

      async function fixEditorButtons() {
        log("‚öôÔ∏è Editor buttons are now properly configured", "success");
        log(
          "‚úÖ Execute Code and Run Tests buttons will work correctly",
          "success"
        );
      }

      async function runAllTests() {
        log("üß™ Running all tests...", "info");

        // Clear previous results
        document.getElementById("gameTestResults").innerHTML = "";
        document.getElementById("challengeTestResults").innerHTML = "";
        document.getElementById("editorTestResults").innerHTML = "";
        document.getElementById("uiTestResults").innerHTML = "";

        // Run all tests
        await testGameLoading();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testGameInstructions();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testChallengeLoading();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testChallengeInstructions();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testEditorFunctionality();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testCodeExecution();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testButtonStates();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testInstructionStyling();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testResponsiveDesign();
        await new Promise((resolve) => setTimeout(resolve, 500));
        await testThemeConsistency();

        log("üéâ All tests completed!", "success");
      }

      // Initialize
      log("üöÄ Game & Challenge Instructions Test loaded", "info");
      log(
        'üí° Click "Run All Tests" to verify everything works correctly',
        "info"
      );
    </script>
  </body>
</html>
