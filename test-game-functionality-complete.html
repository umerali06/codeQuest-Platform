<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complete Game Functionality Test</title>
    <link rel="stylesheet" href="public/styles.css" />
    <link rel="stylesheet" href="public/game-editor-styles.css" />
    <style>
      .test-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #f9f9f9;
      }
      .test-result {
        padding: 10px;
        margin: 5px 0;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
      }
      .game-simulation {
        background: #fff;
        border: 2px solid #007bff;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üéÆ Complete Game Functionality Test</h1>

      <div class="test-section">
        <h2>üìã Test Results</h2>
        <div id="test-results"></div>
        <button onclick="runAllTests()" class="btn btn-primary">
          Run All Tests
        </button>
      </div>

      <!-- Game UI Elements (normally in editor.html) -->
      <div class="game-simulation">
        <h2>üéØ Game Interface Simulation</h2>

        <!-- Game Instructions Panel -->
        <div id="gameInstructions" class="game-panel" style="display: none">
          <h3 id="gameTitle">Game Title</h3>
          <div id="gameDescription">Game description will appear here</div>
          <div id="gameObjectives">
            <h4>Objectives:</h4>
            <ul id="objectivesList"></ul>
          </div>
          <div id="gameTimer">Time: <span id="timeDisplay">00:00</span></div>
          <button id="submitGameBtn" class="btn btn-primary">
            Submit Solution
          </button>
        </div>

        <!-- Editor Container -->
        <div class="editor-container">
          <div class="editor-header">
            <h2 id="challengeTitle">Code Editor</h2>
          </div>

          <!-- Tab Navigation -->
          <div class="tab-nav">
            <button class="tab-btn active" data-tab="html">HTML</button>
            <button class="tab-btn" data-tab="css">CSS</button>
            <button class="tab-btn" data-tab="js">JavaScript</button>
          </div>

          <!-- Editor Containers -->
          <div id="html-monaco" class="editor-tab active">
            <textarea
              placeholder="HTML code here..."
              style="width: 100%; height: 200px"
            ></textarea>
          </div>
          <div id="css-monaco" class="editor-tab">
            <textarea
              placeholder="CSS code here..."
              style="width: 100%; height: 200px"
            ></textarea>
          </div>
          <div id="js-monaco" class="editor-tab">
            <textarea
              placeholder="JavaScript code here..."
              style="width: 100%; height: 200px"
            ></textarea>
          </div>
        </div>

        <!-- Game Results Panel -->
        <div id="gameResults" class="game-panel" style="display: none">
          <h3>üèÜ Game Results</h3>
          <div id="resultsContent"></div>
        </div>
      </div>

      <div class="test-section">
        <h2>üß™ Manual Game Test</h2>
        <p>Test game functionality with sample data:</p>
        <button onclick="simulateGameLaunch()" class="btn btn-success">
          Simulate Game Launch
        </button>
        <button onclick="simulateGameSubmission()" class="btn btn-warning">
          Simulate Game Submission
        </button>
        <button onclick="clearGameMode()" class="btn btn-secondary">
          Clear Game Mode
        </button>
      </div>
    </div>

    <!-- Load editor.js -->
    <script src="public/editor.js"></script>

    <script>
      let testEditor;

      function addTestResult(message, type = "info") {
        const results = document.getElementById("test-results");
        const div = document.createElement("div");
        div.className = `test-result ${type}`;
        div.innerHTML = message;
        results.appendChild(div);
      }

      function runAllTests() {
        const results = document.getElementById("test-results");
        results.innerHTML = "<h3>Running Tests...</h3>";

        try {
          // Test 1: Editor initialization
          addTestResult(
            "‚úÖ Test 1: editor.js loaded without syntax errors",
            "success"
          );

          // Test 2: CodeEditor class
          if (typeof CodeEditor !== "undefined") {
            addTestResult("‚úÖ Test 2: CodeEditor class is defined", "success");
          } else {
            addTestResult(
              "‚ùå Test 2: CodeEditor class is not defined",
              "error"
            );
            return;
          }

          // Test 3: Create editor instance
          testEditor = new CodeEditor();
          addTestResult(
            "‚úÖ Test 3: CodeEditor instance created successfully",
            "success"
          );

          // Test 4: Check game methods
          const gameMethods = [
            "checkForGame",
            "loadGameInstructions",
            "setupGameMode",
            "startGameTimer",
            "showGameCompletionModal",
          ];

          gameMethods.forEach((method, index) => {
            if (typeof testEditor[method] === "function") {
              addTestResult(
                `‚úÖ Test ${4 + index}: ${method} method exists`,
                "success"
              );
            } else {
              addTestResult(
                `‚ùå Test ${4 + index}: ${method} method missing`,
                "error"
              );
            }
          });

          // Test 9: Check properties
          const properties = ["currentGame", "gameStartTime", "gameTimer"];
          properties.forEach((prop, index) => {
            if (testEditor.hasOwnProperty(prop)) {
              addTestResult(
                `‚úÖ Test ${9 + index}: ${prop} property exists`,
                "success"
              );
            } else {
              addTestResult(
                `‚ùå Test ${9 + index}: ${prop} property missing`,
                "error"
              );
            }
          });

          addTestResult("üéâ All automated tests completed!", "success");
        } catch (error) {
          addTestResult(`‚ùå Error during testing: ${error.message}`, "error");
          console.error("Test error:", error);
        }
      }

      function simulateGameLaunch() {
        if (!testEditor) {
          addTestResult(
            "‚ùå Please run tests first to initialize editor",
            "error"
          );
          return;
        }

        // Create sample game data
        const sampleGame = {
          id: 1,
          title: "HTML Basics Challenge",
          description: "Create a simple HTML page with proper structure",
          objectives: [
            "Create an HTML document with DOCTYPE",
            "Add a head section with title",
            "Create a body with heading and paragraph",
            "Use proper HTML5 semantic elements",
          ],
          starter_code: {
            html: "<!DOCTYPE html>\n<html>\n<head>\n  <title>My Page</title>\n</head>\n<body>\n  <!-- Your code here -->\n</body>\n</html>",
            css: "/* Add your styles here */",
            js: "// Add your JavaScript here",
          },
          time_limit: 300,
        };

        try {
          // Simulate game launch
          testEditor.currentGame = sampleGame;
          testEditor.loadGameInstructions(sampleGame);
          testEditor.setupGameMode();

          addTestResult(
            "‚úÖ Game launched successfully with sample data",
            "success"
          );
          addTestResult(`üìù Game: ${sampleGame.title}`, "info");
          addTestResult(
            `‚è±Ô∏è Time limit: ${sampleGame.time_limit} seconds`,
            "info"
          );
        } catch (error) {
          addTestResult(`‚ùå Error launching game: ${error.message}`, "error");
          console.error("Game launch error:", error);
        }
      }

      function simulateGameSubmission() {
        if (!testEditor || !testEditor.currentGame) {
          addTestResult("‚ùå No active game to submit", "error");
          return;
        }

        try {
          // Simulate submission
          const mockResults = {
            success: true,
            score: 85,
            feedback: "Great job! Your HTML structure is correct.",
            time_taken: 180,
            objectives_completed: 3,
            total_objectives: 4,
          };

          // Show completion modal
          if (typeof testEditor.showGameCompletionModal === "function") {
            testEditor.showGameCompletionModal(mockResults);
            addTestResult(
              "‚úÖ Game submission simulated successfully",
              "success"
            );
            addTestResult(`üèÜ Score: ${mockResults.score}/100`, "info");
            addTestResult(`‚è±Ô∏è Time: ${mockResults.time_taken} seconds`, "info");
          } else {
            addTestResult(
              "‚ùå showGameCompletionModal method not found",
              "error"
            );
          }
        } catch (error) {
          addTestResult(`‚ùå Error submitting game: ${error.message}`, "error");
          console.error("Game submission error:", error);
        }
      }

      function clearGameMode() {
        if (testEditor) {
          testEditor.currentGame = null;
          testEditor.gameStartTime = null;
          if (testEditor.gameTimer) {
            clearInterval(testEditor.gameTimer);
            testEditor.gameTimer = null;
          }

          // Hide game panels
          const gameInstructions = document.getElementById("gameInstructions");
          const gameResults = document.getElementById("gameResults");
          if (gameInstructions) gameInstructions.style.display = "none";
          if (gameResults) gameResults.style.display = "none";

          addTestResult("‚úÖ Game mode cleared", "success");
        }
      }

      // Auto-run tests when page loads
      window.addEventListener("load", () => {
        setTimeout(() => {
          addTestResult("üöÄ Starting automated tests...", "info");
          runAllTests();
        }, 500);
      });
    </script>
  </body>
</html>
