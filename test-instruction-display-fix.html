<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instruction Display Fix Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .test-section {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
      }
      .test-section h3 {
        margin-top: 0;
        color: #333;
      }
      .log-entry {
        padding: 8px;
        margin: 5px 0;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
      }
      .log-info {
        background: #e3f2fd;
        color: #1565c0;
      }
      .log-success {
        background: #e8f5e8;
        color: #2e7d32;
      }
      .log-error {
        background: #ffebee;
        color: #c62828;
      }
      .log-warning {
        background: #fff3e0;
        color: #ef6c00;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background-color: #0056b3;
      }
      .toast-demo {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(30, 30, 30, 0.95);
        color: white;
        padding: 16px 20px;
        border-radius: 12px;
        border-left: 4px solid #28a745;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        display: none;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        max-width: 500px;
        z-index: 10001;
      }
      .toast-demo.show {
        display: flex;
        animation: slideInRight 0.3s ease-out;
      }
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üß™ Instruction Display & Toast Fix Test</h1>
      <p>
        This test verifies that game/challenge instructions display properly and
        toasts are visible.
      </p>

      <div class="test-section">
        <h3>üçû Toast Notification Test</h3>
        <p>Test if toast notifications are visible and properly styled.</p>
        <button onclick="testToastNotifications()">
          Test Toast Notifications
        </button>
        <button onclick="testToastStyles()">Test Toast Styles</button>
      </div>

      <div class="test-section">
        <h3>üéÆ Game Instruction Display Test</h3>
        <p>Test if game instructions show properly when launching a game.</p>
        <button onclick="testGameInstructionDisplay()">
          Test Game Instructions
        </button>
        <button onclick="simulateGameLaunch()">Simulate Game Launch</button>
      </div>

      <div class="test-section">
        <h3>üéØ Challenge Instruction Display Test</h3>
        <p>
          Test if challenge instructions show properly when loading a challenge.
        </p>
        <button onclick="testChallengeInstructionDisplay()">
          Test Challenge Instructions
        </button>
        <button onclick="simulateChallengeLaunch()">
          Simulate Challenge Launch
        </button>
      </div>

      <div class="test-section">
        <h3>üìã DOM Element Verification</h3>
        <p>Verify that all required DOM elements exist in editor.html.</p>
        <button onclick="testDOMElements()">Test DOM Elements</button>
        <button onclick="testInstructionPanels()">
          Test Instruction Panels
        </button>
      </div>

      <div class="test-section">
        <h3>üîÑ Complete Integration Test</h3>
        <button onclick="runCompleteTest()">Run Complete Test</button>
        <button onclick="clearLogs()">Clear Logs</button>
      </div>

      <div id="testResults"></div>
    </div>

    <!-- Toast Demo -->
    <div id="toastDemo" class="toast-demo">
      <i class="fas fa-check-circle"></i>
      <span>This is a test toast notification!</span>
      <button
        onclick="hideToastDemo()"
        style="
          background: none;
          border: none;
          color: rgba(255, 255, 255, 0.7);
          cursor: pointer;
          padding: 4px;
        "
      >
        √ó
      </button>
    </div>

    <script>
      function log(message, type = "info") {
        const resultsDiv = document.getElementById("testResults");
        const logEntry = document.createElement("div");
        logEntry.className = `log-entry log-${type}`;
        logEntry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
        resultsDiv.appendChild(logEntry);
        resultsDiv.scrollTop = resultsDiv.scrollHeight;
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      function clearLogs() {
        document.getElementById("testResults").innerHTML = "";
      }

      function testToastNotifications() {
        log("üçû Testing toast notifications...", "info");

        // Test if toast container styles are available
        const testToast = document.createElement("div");
        testToast.className = "toast toast-success";
        testToast.innerHTML = `
                <div class="toast-content">
                    <i class="fas fa-check-circle"></i>
                    <span class="toast-message">Test toast message</span>
                </div>
                <button class="toast-close">√ó</button>
            `;

        // Check if styles are applied
        document.body.appendChild(testToast);
        const computedStyle = window.getComputedStyle(testToast);

        if (computedStyle.position === "static") {
          log(
            "‚ùå Toast styles not loaded - position should be fixed/absolute",
            "error"
          );
        } else {
          log("‚úÖ Toast styles are loaded", "success");
        }

        // Remove test toast
        testToast.remove();

        // Show demo toast
        showToastDemo();
      }

      function testToastStyles() {
        log("üé® Testing toast styles...", "info");

        // Check if enhanced-editor-styles.css is loaded
        const stylesheets = Array.from(document.styleSheets);
        const hasEnhancedStyles = stylesheets.some((sheet) => {
          try {
            return (
              sheet.href && sheet.href.includes("enhanced-editor-styles.css")
            );
          } catch (e) {
            return false;
          }
        });

        if (hasEnhancedStyles) {
          log("‚úÖ Enhanced editor styles CSS is loaded", "success");
        } else {
          log("‚ùå Enhanced editor styles CSS not found", "error");
          log(
            "üí° Make sure enhanced-editor-styles.css is included in editor.html",
            "warning"
          );
        }

        // Test CSS rules
        try {
          const testElement = document.createElement("div");
          testElement.className = "toast-container";
          document.body.appendChild(testElement);

          const style = window.getComputedStyle(testElement);
          if (style.position === "fixed") {
            log("‚úÖ Toast container positioning is correct", "success");
          } else {
            log("‚ùå Toast container positioning is incorrect", "error");
          }

          testElement.remove();
        } catch (error) {
          log(`‚ùå Error testing styles: ${error.message}`, "error");
        }
      }

      function showToastDemo() {
        const toastDemo = document.getElementById("toastDemo");
        toastDemo.classList.add("show");
        log("‚úÖ Demo toast shown - check top-right corner", "success");

        setTimeout(() => {
          hideToastDemo();
        }, 3000);
      }

      function hideToastDemo() {
        const toastDemo = document.getElementById("toastDemo");
        toastDemo.classList.remove("show");
      }

      function testGameInstructionDisplay() {
        log("üéÆ Testing game instruction display...", "info");

        // Check if game instruction elements exist
        const gameElements = {
          gameInstructions: document.getElementById("gameInstructions"),
          gameTitle: document.getElementById("gameTitle"),
          gameDescription: document.getElementById("gameDescription"),
          objectivesList: document.getElementById("objectivesList"),
          gameDifficulty: document.getElementById("gameDifficulty"),
        };

        let foundElements = 0;
        Object.entries(gameElements).forEach(([name, element]) => {
          if (element) {
            log(`‚úÖ Found ${name}`, "success");
            foundElements++;
          } else {
            log(`‚ùå Missing ${name}`, "error");
          }
        });

        if (foundElements === Object.keys(gameElements).length) {
          log("‚úÖ All game instruction elements found", "success");
        } else {
          log(
            `‚ùå Missing ${
              Object.keys(gameElements).length - foundElements
            } game elements`,
            "error"
          );
        }
      }

      function simulateGameLaunch() {
        log("üéÆ Simulating game launch...", "info");

        // Simulate game data
        const sampleGame = {
          id: "test-game",
          title: "Sample Coding Game",
          description: "This is a test game to verify instruction display.",
          instructions: "Complete the coding challenge within the time limit.",
          difficulty: "medium",
          xp_reward: 100,
          time_limit: 600,
          category: "JavaScript",
          objectives: [
            'Write a function that returns "Hello World"',
            "Test your function",
            "Submit your solution",
          ],
        };

        // Try to populate game instructions
        const gameInstructions = document.getElementById("gameInstructions");
        if (gameInstructions) {
          gameInstructions.style.display = "block";

          const gameTitle = document.getElementById("gameTitle");
          if (gameTitle) gameTitle.textContent = sampleGame.title;

          const gameDescription = document.getElementById("gameDescription");
          if (gameDescription) {
            gameDescription.innerHTML = `
                        <h4>üéØ Game Description</h4>
                        <p>${sampleGame.description}</p>
                        <h4>üìã Instructions</h4>
                        <p>${sampleGame.instructions}</p>
                    `;
          }

          const objectivesList = document.getElementById("objectivesList");
          if (objectivesList) {
            objectivesList.innerHTML = sampleGame.objectives
              .map((obj) => `<li>${obj}</li>`)
              .join("");
          }

          const gameDifficulty = document.getElementById("gameDifficulty");
          if (gameDifficulty)
            gameDifficulty.textContent = sampleGame.difficulty;

          log("‚úÖ Game instructions populated and displayed", "success");
          log("üí° Check the page for the game instructions panel", "info");
        } else {
          log("‚ùå Game instructions panel not found", "error");
        }
      }

      function testChallengeInstructionDisplay() {
        log("üéØ Testing challenge instruction display...", "info");

        // Check if challenge instruction elements exist
        const challengeElements = {
          challengeInstructions: document.getElementById(
            "challengeInstructions"
          ),
          challengeTitlePanel: document.getElementById("challengeTitlePanel"),
          challengeDescriptionPanel: document.getElementById(
            "challengeDescriptionPanel"
          ),
          testStatements: document.getElementById("testStatements"),
          challengeDifficultyPanel: document.getElementById(
            "challengeDifficultyPanel"
          ),
          challengeXPPanel: document.getElementById("challengeXPPanel"),
        };

        let foundElements = 0;
        Object.entries(challengeElements).forEach(([name, element]) => {
          if (element) {
            log(`‚úÖ Found ${name}`, "success");
            foundElements++;
          } else {
            log(`‚ùå Missing ${name}`, "error");
          }
        });

        if (foundElements === Object.keys(challengeElements).length) {
          log("‚úÖ All challenge instruction elements found", "success");
        } else {
          log(
            `‚ùå Missing ${
              Object.keys(challengeElements).length - foundElements
            } challenge elements`,
            "error"
          );
        }
      }

      function simulateChallengeLaunch() {
        log("üéØ Simulating challenge launch...", "info");

        // Simulate challenge data
        const sampleChallenge = {
          id: "test-challenge",
          title: "Sample Coding Challenge",
          description:
            "This is a test challenge to verify instruction display.",
          instructions: "Create a responsive contact card using HTML and CSS.",
          difficulty: "easy",
          xp_reward: 50,
          category: "HTML/CSS",
          tags: ["HTML", "CSS", "Responsive"],
        };

        // Try to populate challenge instructions
        const challengeInstructions = document.getElementById(
          "challengeInstructions"
        );
        if (challengeInstructions) {
          challengeInstructions.style.display = "block";

          const challengeTitlePanel = document.getElementById(
            "challengeTitlePanel"
          );
          if (challengeTitlePanel)
            challengeTitlePanel.textContent = sampleChallenge.title;

          const challengeDescriptionPanel = document.getElementById(
            "challengeDescriptionPanel"
          );
          if (challengeDescriptionPanel) {
            challengeDescriptionPanel.innerHTML = `
                        <h4>üéØ Challenge Description</h4>
                        <p>${sampleChallenge.description}</p>
                        <h4>üìã Instructions</h4>
                        <p>${sampleChallenge.instructions}</p>
                        <div class="challenge-metadata">
                            <p><strong>Category:</strong> ${
                              sampleChallenge.category
                            }</p>
                            <p><strong>Tags:</strong> ${sampleChallenge.tags.join(
                              ", "
                            )}</p>
                        </div>
                    `;
          }

          const testStatements = document.getElementById("testStatements");
          if (testStatements) {
            testStatements.innerHTML = `
                        <li>Create a contact card with name, email, and phone</li>
                        <li>Make it responsive for mobile devices</li>
                        <li>Use proper semantic HTML</li>
                        <li>Style with CSS for visual appeal</li>
                    `;
          }

          const challengeDifficultyPanel = document.getElementById(
            "challengeDifficultyPanel"
          );
          if (challengeDifficultyPanel)
            challengeDifficultyPanel.textContent = sampleChallenge.difficulty;

          const challengeXPPanel = document.getElementById("challengeXPPanel");
          if (challengeXPPanel)
            challengeXPPanel.textContent = `+${sampleChallenge.xp_reward} XP`;

          log("‚úÖ Challenge instructions populated and displayed", "success");
          log("üí° Check the page for the challenge instructions panel", "info");
        } else {
          log("‚ùå Challenge instructions panel not found", "error");
        }
      }

      function testDOMElements() {
        log("üìã Testing DOM elements...", "info");

        const requiredElements = [
          "challengeTitle",
          "challengeDifficulty",
          "challengeXP",
          "defaultDescription",
          "challengeDescriptionContent",
          "gameInstructions",
          "challengeInstructions",
          "runTestsBtn",
          "submitBtn",
        ];

        let foundCount = 0;
        requiredElements.forEach((elementId) => {
          const element = document.getElementById(elementId);
          if (element) {
            log(`‚úÖ Found ${elementId}`, "success");
            foundCount++;
          } else {
            log(`‚ùå Missing ${elementId}`, "error");
          }
        });

        log(
          `üìä Found ${foundCount}/${requiredElements.length} required elements`,
          foundCount === requiredElements.length ? "success" : "warning"
        );
      }

      function testInstructionPanels() {
        log("üìã Testing instruction panels...", "info");

        const panels = {
          gameInstructions: document.getElementById("gameInstructions"),
          challengeInstructions: document.getElementById(
            "challengeInstructions"
          ),
        };

        Object.entries(panels).forEach(([name, panel]) => {
          if (panel) {
            log(`‚úÖ ${name} panel exists`, "success");

            // Test visibility toggle
            const originalDisplay = panel.style.display;
            panel.style.display = "block";

            if (panel.offsetParent !== null) {
              log(`‚úÖ ${name} panel can be made visible`, "success");
            } else {
              log(`‚ö†Ô∏è ${name} panel visibility issue`, "warning");
            }

            panel.style.display = originalDisplay;
          } else {
            log(`‚ùå ${name} panel not found`, "error");
          }
        });
      }

      async function runCompleteTest() {
        log("üîÑ Running complete instruction display test...", "info");

        const tests = [
          testToastNotifications,
          testToastStyles,
          testGameInstructionDisplay,
          testChallengeInstructionDisplay,
          testDOMElements,
          testInstructionPanels,
        ];

        for (let i = 0; i < tests.length; i++) {
          log(`Running test ${i + 1}/${tests.length}...`, "info");
          await tests[i]();
          await new Promise((resolve) => setTimeout(resolve, 500));
        }

        log("üéâ Complete instruction display test finished!", "success");
      }

      // Initialize test
      window.addEventListener("DOMContentLoaded", () => {
        log("üß™ Instruction Display Fix Test loaded", "info");
        log("üí° Run individual tests or complete test to verify fixes", "info");
      });
    </script>
  </body>
</html>
