<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Assistant - Final Fixes Test</title>
    <link rel="stylesheet" href="public/ai-assistant.css" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 20px;
        background: #f9fafb;
      }
      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
      }
      .test-section h3 {
        margin-top: 0;
        color: #374151;
      }
      .status {
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 500;
        margin: 10px 0;
      }
      .status.success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
      }
      .status.error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
      }
      .test-button {
        background: #6366f1;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
      }
      .test-button:hover {
        background: #5855f7;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üîß AI Assistant - Final Fixes Test</h1>
      <p>Testing the three main fixes implemented:</p>

      <div class="test-section">
        <h3>1. PHP Array to String Conversion Fix</h3>
        <p>Testing context handling with different data types:</p>
        <button class="test-button" onclick="testArrayContext()">
          Test Array Context
        </button>
        <button class="test-button" onclick="testStringContext()">
          Test String Context
        </button>
        <button class="test-button" onclick="testEmptyContext()">
          Test Empty Context
        </button>
        <div id="php-test-results"></div>
      </div>

      <div class="test-section">
        <h3>2. Input Placeholder Visibility</h3>
        <p>
          The AI input placeholder should now be clearly visible with darker
          text.
        </p>
        <div class="status success">
          ‚úÖ Open the AI assistant and check the input placeholder visibility
        </div>
      </div>

      <div class="test-section">
        <h3>3. Send Button Arrow Icon</h3>
        <p>The send button should now display a proper arrow icon (SVG).</p>
        <div class="status success">
          ‚úÖ Open the AI assistant and check the send button icon
        </div>
      </div>

      <div class="test-section">
        <h3>üß™ Interactive Tests</h3>
        <button class="test-button" onclick="openAI()">
          Open AI Assistant
        </button>
        <button class="test-button" onclick="testAIMessage()">
          Send Test Message
        </button>
        <button class="test-button" onclick="testContextMessage()">
          Send Message with Context
        </button>
      </div>

      <div id="test-log"></div>
    </div>

    <script src="public/ai-assistant.js"></script>
    <script>
      function log(message, type = "info") {
        const logDiv = document.getElementById("test-log");
        const timestamp = new Date().toLocaleTimeString();
        const statusClass = type === "error" ? "error" : "success";
        logDiv.innerHTML += `<div class="status ${statusClass}">[${timestamp}] ${message}</div>`;
      }

      function openAI() {
        if (window.aiAssistant) {
          window.aiAssistant.toggleChat();
          log(
            "AI Assistant opened - check placeholder visibility and send button icon"
          );
        } else {
          log("AI Assistant not initialized", "error");
        }
      }

      async function testArrayContext() {
        const results = document.getElementById("php-test-results");
        results.innerHTML =
          '<div class="status">Testing array context...</div>';

        try {
          const response = await fetch("/api/ai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              message: "Test message",
              context: ["item1", "item2", "item3"], // Array context
            }),
          });

          if (response.ok) {
            results.innerHTML +=
              '<div class="status success">‚úÖ Array context handled successfully</div>';
          } else {
            const error = await response.text();
            results.innerHTML += `<div class="status error">‚ùå Array context failed: ${error}</div>`;
          }
        } catch (error) {
          results.innerHTML += `<div class="status error">‚ùå Array context error: ${error.message}</div>`;
        }
      }

      async function testStringContext() {
        const results = document.getElementById("php-test-results");

        try {
          const response = await fetch("/api/ai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              message: "Test message",
              context: "This is a string context", // String context
            }),
          });

          if (response.ok) {
            results.innerHTML +=
              '<div class="status success">‚úÖ String context handled successfully</div>';
          } else {
            const error = await response.text();
            results.innerHTML += `<div class="status error">‚ùå String context failed: ${error}</div>`;
          }
        } catch (error) {
          results.innerHTML += `<div class="status error">‚ùå String context error: ${error.message}</div>`;
        }
      }

      async function testEmptyContext() {
        const results = document.getElementById("php-test-results");

        try {
          const response = await fetch("/api/ai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              message: "Test message",
              // No context provided
            }),
          });

          if (response.ok) {
            results.innerHTML +=
              '<div class="status success">‚úÖ Empty context handled successfully</div>';
          } else {
            const error = await response.text();
            results.innerHTML += `<div class="status error">‚ùå Empty context failed: ${error}</div>`;
          }
        } catch (error) {
          results.innerHTML += `<div class="status error">‚ùå Empty context error: ${error.message}</div>`;
        }
      }

      function testAIMessage() {
        if (window.aiAssistant) {
          window.aiAssistant.sendMessage(
            "Hello, this is a test message. Can you help me with HTML?"
          );
          log("Test message sent to AI");
        } else {
          log("AI Assistant not initialized", "error");
        }
      }

      function testContextMessage() {
        if (window.aiAssistant) {
          // Simulate sending a message with context
          window.aiAssistant.sendMessage("Explain this code to me");
          log("Context message sent to AI");
        } else {
          log("AI Assistant not initialized", "error");
        }
      }

      // Initialize test
      document.addEventListener("DOMContentLoaded", () => {
        log("AI Assistant fixes test page loaded");
        log('Click "Open AI Assistant" to test the UI fixes');
      });
    </script>
  </body>
</html>
