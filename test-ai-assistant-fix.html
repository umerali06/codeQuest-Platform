<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Assistant Fix Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        border-color: #bee5eb;
      }
      .warning {
        background-color: #fff3cd;
        border-color: #ffeaa7;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        cursor: pointer;
        border: none;
        border-radius: 4px;
        background-color: #007bff;
        color: white;
      }
      button:hover {
        background-color: #0056b3;
      }
      .btn-success {
        background-color: #28a745;
      }
      .btn-success:hover {
        background-color: #218838;
      }
      .page-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .page-card {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #f8f9fa;
      }
      .page-card h4 {
        margin: 0 0 10px 0;
        color: #333;
      }
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .status-ok {
        background-color: #28a745;
      }
      .status-error {
        background-color: #dc3545;
      }
      .status-warning {
        background-color: #ffc107;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        overflow-x: auto;
        border-radius: 4px;
        border: 1px solid #e9ecef;
        font-size: 12px;
      }
      .test-message {
        margin: 10px 0;
        padding: 10px;
        border-radius: 4px;
        border-left: 4px solid #007bff;
        background: #f8f9fa;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ü§ñ AI Assistant Fix Verification</h1>

      <div class="section success">
        <h2>‚úÖ Issues Fixed</h2>
        <ul>
          <li>
            <strong>Duplicate AI scripts in index.html</strong> - Removed
            duplicate includes
          </li>
          <li>
            <strong>Missing AI assistant in learn.html</strong> - Added
            ai-assistant.js script
          </li>
          <li>
            <strong>500 Internal Server Error</strong> - Implemented fallback AI
            responses
          </li>
          <li>
            <strong>API configuration</strong> - Works without external API key
          </li>
        </ul>
      </div>

      <div class="section">
        <h2>üß™ Test AI API Directly</h2>
        <p>Test the AI API endpoint to ensure it's working:</p>

        <div style="margin: 10px 0">
          <label><strong>Ask the AI:</strong></label
          ><br />
          <input
            type="text"
            id="aiQuestion"
            placeholder="Ask about HTML, CSS, JavaScript..."
            style="width: 70%; padding: 8px; margin: 5px 0"
            value="How do I create a responsive navigation menu?"
          />
          <button onclick="testAIAPI()" class="btn-success">Ask AI</button>
        </div>

        <div id="aiResponse"></div>
      </div>

      <div class="section">
        <h2>üìÑ Page AI Assistant Status</h2>
        <p>Check if AI assistant is properly included on all pages:</p>

        <div class="page-grid">
          <div class="page-card">
            <h4><span class="status-indicator status-ok"></span>index.html</h4>
            <p>‚úÖ AI assistant included</p>
            <button onclick="openPage('index.html')">Test Page</button>
          </div>

          <div class="page-card">
            <h4><span class="status-indicator status-ok"></span>learn.html</h4>
            <p>‚úÖ AI assistant added</p>
            <button onclick="openPage('learn.html')">Test Page</button>
          </div>

          <div class="page-card">
            <h4><span class="status-indicator status-ok"></span>editor.html</h4>
            <p>‚úÖ AI assistant included</p>
            <button onclick="openPage('editor.html')">Test Page</button>
          </div>

          <div class="page-card">
            <h4>
              <span class="status-indicator status-ok"></span>challenges.html
            </h4>
            <p>‚úÖ AI assistant included</p>
            <button onclick="openPage('challenges.html')">Test Page</button>
          </div>

          <div class="page-card">
            <h4>
              <span class="status-indicator status-ok"></span>dashboard.html
            </h4>
            <p>‚úÖ AI assistant included</p>
            <button onclick="openPage('dashboard.html')">Test Page</button>
          </div>

          <div class="page-card">
            <h4><span class="status-indicator status-ok"></span>games.html</h4>
            <p>‚úÖ AI assistant included</p>
            <button onclick="openPage('games.html')">Test Page</button>
          </div>

          <div class="page-card">
            <h4>
              <span class="status-indicator status-ok"></span>leaderboard.html
            </h4>
            <p>‚úÖ AI assistant included</p>
            <button onclick="openPage('leaderboard.html')">Test Page</button>
          </div>
        </div>
      </div>

      <div class="section info">
        <h2>üéØ How to Test AI Assistant</h2>
        <p>On each page, look for:</p>
        <ol>
          <li>
            <strong>Floating AI Button</strong> - Should appear in bottom-right
            corner
          </li>
          <li>
            <strong>Click to Open Chat</strong> - Button should open AI chat
            interface
          </li>
          <li>
            <strong>Send Messages</strong> - Type questions and get responses
          </li>
          <li>
            <strong>No Console Errors</strong> - Check browser console (F12) for
            errors
          </li>
        </ol>

        <div class="warning">
          <h4>‚ö†Ô∏è Note</h4>
          <p>
            The AI now uses local fallback responses since no external API key
            is configured. This provides helpful coding assistance without
            requiring external services.
          </p>
        </div>
      </div>

      <div class="section">
        <h2>üîß AI Response Examples</h2>
        <p>Test different types of questions:</p>

        <button onclick="testSpecificQuestion('How do I use CSS flexbox?')">
          CSS Flexbox
        </button>
        <button onclick="testSpecificQuestion('How do I create HTML forms?')">
          HTML Forms
        </button>
        <button
          onclick="testSpecificQuestion('How do I handle JavaScript events?')"
        >
          JS Events
        </button>
        <button onclick="testSpecificQuestion('I have a bug in my code')">
          Debugging Help
        </button>
        <button
          onclick="testSpecificQuestion('How do I learn web development?')"
        >
          Learning Tips
        </button>

        <div id="exampleResponse"></div>
      </div>
    </div>

    <script>
      async function testAIAPI() {
        const question = document.getElementById("aiQuestion").value;
        const responseDiv = document.getElementById("aiResponse");

        if (!question.trim()) {
          responseDiv.innerHTML =
            '<div class="error">Please enter a question</div>';
          return;
        }

        responseDiv.innerHTML = '<div class="info">Asking AI...</div>';

        try {
          const response = await fetch("/api/ai", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: question,
            }),
          });

          const data = await response.json();

          if (response.ok && data.success) {
            responseDiv.innerHTML = `<div class="success">
                        <h4>‚úÖ AI Response (${data.source || "unknown"})</h4>
                        <div class="test-message">${formatAIResponse(
                          data.response
                        )}</div>
                    </div>`;
          } else {
            responseDiv.innerHTML = `<div class="error">
                        <h4>‚ùå AI Error</h4>
                        <p>${data.error || "Unknown error"}</p>
                    </div>`;
          }
        } catch (error) {
          responseDiv.innerHTML = `<div class="error">
                    <h4>‚ùå Network Error</h4>
                    <p>${error.message}</p>
                </div>`;
        }
      }

      async function testSpecificQuestion(question) {
        document.getElementById("aiQuestion").value = question;
        const responseDiv = document.getElementById("exampleResponse");

        responseDiv.innerHTML =
          '<div class="info">Testing: ' + question + "</div>";

        try {
          const response = await fetch("/api/ai", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: question,
            }),
          });

          const data = await response.json();

          if (response.ok && data.success) {
            responseDiv.innerHTML = `<div class="success">
                        <h4>‚úÖ Response for: "${question}"</h4>
                        <div class="test-message">${formatAIResponse(
                          data.response
                        )}</div>
                    </div>`;
          } else {
            responseDiv.innerHTML = `<div class="error">
                        <h4>‚ùå Error for: "${question}"</h4>
                        <p>${data.error || "Unknown error"}</p>
                    </div>`;
          }
        } catch (error) {
          responseDiv.innerHTML = `<div class="error">
                    <h4>‚ùå Network Error</h4>
                    <p>${error.message}</p>
                </div>`;
        }
      }

      function formatAIResponse(response) {
        // Convert markdown-style formatting to HTML
        return response
          .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
          .replace(/```(.*?)```/gs, "<pre>$1</pre>")
          .replace(/`(.*?)`/g, "<code>$1</code>")
          .replace(/\n/g, "<br>");
      }

      function openPage(pageName) {
        window.open(pageName, "_blank");
      }

      // Auto-test on load
      window.addEventListener("load", () => {
        testAIAPI();
      });
    </script>
  </body>
</html>
