<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Games Auth Fix Test</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 20px;
        background: #0f172a;
        color: #f8fafc;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(15, 23, 42, 0.8);
        padding: 30px;
        border-radius: 15px;
        border: 1px solid rgba(99, 102, 241, 0.2);
      }
      .status {
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 500;
        margin: 10px 0;
      }
      .status.success {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.3);
      }
      .status.error {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: 1px solid rgba(239, 68, 68, 0.3);
      }
      .status.info {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
        border: 1px solid rgba(59, 130, 246, 0.3);
      }
      .status.warning {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border: 1px solid rgba(245, 158, 11, 0.3);
      }
      .test-button {
        background: #6366f1;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
      }
      .test-button:hover {
        background: #5855f7;
        transform: translateY(-1px);
      }
      .test-button.success {
        background: #10b981;
      }
      .test-button.success:hover {
        background: #059669;
      }
      .test-button.warning {
        background: #f59e0b;
      }
      .test-button.warning:hover {
        background: #d97706;
      }
      .fix-summary {
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }
      .auth-status {
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Games Authentication Fix Test</h1>
      <p>
        Testing the authentication system and toast notifications for games.
      </p>

      <div class="fix-summary">
        <h3>üéØ Authentication Fixes Applied:</h3>
        <ul>
          <li>
            ‚úÖ <strong>Added playGame() method:</strong> Handles game launching
            with auth check
          </li>
          <li>
            ‚úÖ <strong>Toast notifications:</strong> Replaced alerts with
            elegant toast messages
          </li>
          <li>
            ‚úÖ <strong>Enhanced auth check:</strong> Proper token validation
            with API
          </li>
          <li>
            ‚úÖ <strong>User info display:</strong> Shows login status and user
            info
          </li>
          <li>
            ‚úÖ <strong>Auth UI updates:</strong> Dynamic UI based on login
            status
          </li>
        </ul>
      </div>

      <div id="authStatus" class="auth-status">
        <strong>Current Auth Status:</strong>
        <span id="authStatusText">Checking...</span>
      </div>

      <div>
        <button class="test-button" onclick="testAuthStatus()">
          üîç Check Auth Status
        </button>
        <button class="test-button" onclick="testToastNotifications()">
          üçû Test Toast Notifications
        </button>
        <button class="test-button" onclick="simulateLogin()">
          üîë Simulate Login
        </button>
        <button class="test-button warning" onclick="simulateLogout()">
          üö™ Simulate Logout
        </button>
        <button class="test-button" onclick="testPlayGame()">
          üéÆ Test Play Game
        </button>
        <button class="test-button success" onclick="openGamesPage()">
          üéØ Open Games Page
        </button>
        <button class="test-button" onclick="clearResults()">
          üóëÔ∏è Clear Results
        </button>
      </div>

      <div id="results"></div>
    </div>

    <script>
      function log(message, type = "info") {
        const results = document.getElementById("results");
        const div = document.createElement("div");
        div.className = `status ${type}`;
        div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
        results.appendChild(div);
      }

      function updateAuthStatus(status, user = null) {
        const authStatusText = document.getElementById("authStatusText");
        if (status === "authenticated" && user) {
          authStatusText.innerHTML = `‚úÖ Authenticated as ${
            user.username || user.email
          }`;
          authStatusText.style.color = "#10b981";
        } else {
          authStatusText.innerHTML = "‚ùå Not authenticated";
          authStatusText.style.color = "#ef4444";
        }
      }

      async function testAuthStatus() {
        log("üîç Testing authentication status...", "info");

        try {
          const token =
            localStorage.getItem("auth_token") ||
            sessionStorage.getItem("auth_token");

          if (!token) {
            log("‚ùå No auth token found", "warning");
            updateAuthStatus("not_authenticated");
            return;
          }

          log(`‚úÖ Auth token found: ${token.substring(0, 10)}...`, "success");

          // Test API call
          const response = await fetch("/api/user", {
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          log(
            `API Response status: ${response.status}`,
            response.ok ? "success" : "error"
          );

          if (response.ok) {
            const result = await response.json();
            if (result.success && result.user) {
              log(
                `‚úÖ User authenticated: ${
                  result.user.username || result.user.email
                }`,
                "success"
              );
              updateAuthStatus("authenticated", result.user);
            } else {
              log("‚ùå Invalid API response format", "error");
              updateAuthStatus("not_authenticated");
            }
          } else {
            log("‚ùå Token validation failed", "error");
            updateAuthStatus("not_authenticated");
          }
        } catch (error) {
          log(`‚ùå Auth test failed: ${error.message}`, "error");
          updateAuthStatus("not_authenticated");
        }
      }

      function testToastNotifications() {
        log("üçû Testing toast notification system...", "info");

        // Test different toast types
        setTimeout(
          () => showTestToast("This is an info toast! üìò", "info"),
          500
        );
        setTimeout(
          () => showTestToast("Success toast works perfectly! ‚úÖ", "success"),
          1500
        );
        setTimeout(
          () => showTestToast("Warning toast for attention! ‚ö†Ô∏è", "warning"),
          2500
        );
        setTimeout(
          () => showTestToast("Error toast for problems! ‚ùå", "error"),
          3500
        );

        log("‚úÖ Toast notifications triggered", "success");
      }

      function showTestToast(message, type = "info") {
        // Remove existing toasts
        const existingToasts = document.querySelectorAll(".toast-notification");
        existingToasts.forEach((toast) => toast.remove());

        // Create toast element
        const toast = document.createElement("div");
        toast.className = `toast-notification toast-${type}`;
        toast.innerHTML = `
              <div class="toast-content">
                <div class="toast-icon">
                  ${
                    type === "success"
                      ? "‚úÖ"
                      : type === "warning"
                      ? "‚ö†Ô∏è"
                      : type === "error"
                      ? "‚ùå"
                      : "‚ÑπÔ∏è"
                  }
                </div>
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
              </div>
            `;

        // Add toast styles
        if (!document.getElementById("toast-styles")) {
          const styles = document.createElement("style");
          styles.id = "toast-styles";
          styles.textContent = `
                    .toast-notification {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        z-index: 10000;
                        min-width: 300px;
                        max-width: 500px;
                        background: rgba(15, 23, 42, 0.95);
                        border-radius: 12px;
                        border: 1px solid rgba(99, 102, 241, 0.3);
                        backdrop-filter: blur(10px);
                        animation: slideInRight 0.3s ease-out;
                        box-shadow: 0 20px 25px rgba(0, 0, 0, 0.3);
                    }
                    .toast-content {
                        display: flex;
                        align-items: center;
                        padding: 16px;
                        gap: 12px;
                    }
                    .toast-icon {
                        font-size: 1.2em;
                        flex-shrink: 0;
                    }
                    .toast-message {
                        flex: 1;
                        color: #f8fafc;
                        font-weight: 500;
                    }
                    .toast-close {
                        background: none;
                        border: none;
                        color: #94a3b8;
                        font-size: 1.2em;
                        cursor: pointer;
                        padding: 0;
                        width: 24px;
                        height: 24px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 4px;
                        transition: all 0.2s ease;
                    }
                    .toast-close:hover {
                        background: rgba(255, 255, 255, 0.1);
                        color: #f8fafc;
                    }
                    .toast-success {
                        border-color: rgba(16, 185, 129, 0.5);
                        background: rgba(16, 185, 129, 0.1);
                    }
                    .toast-warning {
                        border-color: rgba(245, 158, 11, 0.5);
                        background: rgba(245, 158, 11, 0.1);
                    }
                    .toast-error {
                        border-color: rgba(239, 68, 68, 0.5);
                        background: rgba(239, 68, 68, 0.1);
                    }
                    .toast-info {
                        border-color: rgba(59, 130, 246, 0.5);
                        background: rgba(59, 130, 246, 0.1);
                    }
                    @keyframes slideInRight {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                `;
          document.head.appendChild(styles);
        }

        document.body.appendChild(toast);

        // Auto-remove after 4 seconds
        setTimeout(() => {
          if (toast.parentElement) {
            toast.style.animation = "slideInRight 0.3s ease-out reverse";
            setTimeout(() => toast.remove(), 300);
          }
        }, 4000);
      }

      function simulateLogin() {
        log("üîë Simulating login...", "info");

        // Simulate setting a token
        const fakeToken = "test_token_" + Date.now();
        localStorage.setItem("auth_token", fakeToken);

        log("‚úÖ Fake token set in localStorage", "success");
        showTestToast("Login simulation complete! üéâ", "success");

        // Update status
        updateAuthStatus("authenticated", { username: "TestUser" });
      }

      function simulateLogout() {
        log("üö™ Simulating logout...", "info");

        localStorage.removeItem("auth_token");
        sessionStorage.removeItem("auth_token");

        log("‚úÖ Auth tokens cleared", "success");
        showTestToast("Logged out successfully! üëã", "info");

        updateAuthStatus("not_authenticated");
      }

      function testPlayGame() {
        log("üéÆ Testing play game functionality...", "info");

        const token =
          localStorage.getItem("auth_token") ||
          sessionStorage.getItem("auth_token");

        if (!token) {
          log("‚ùå No auth token - should show login required toast", "warning");
          showTestToast("Please log in to play games", "warning");
        } else {
          log("‚úÖ Auth token found - game would launch", "success");
          showTestToast("Game launching... üöÄ", "success");
        }
      }

      function openGamesPage() {
        window.open("public/games.html", "_blank");
      }

      function clearResults() {
        document.getElementById("results").innerHTML = "";
      }

      // Auto-run auth check on load
      document.addEventListener("DOMContentLoaded", () => {
        log("üîß Games auth fix test loaded", "info");
        testAuthStatus();
      });
    </script>
  </body>
</html>
