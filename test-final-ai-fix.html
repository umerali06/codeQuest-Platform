<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Final AI Assistant Fix Test</title>
    <link rel="stylesheet" href="ai-assistant.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      .success-banner {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .success {
        border-color: #4ade80;
        background: rgba(74, 222, 128, 0.1);
      }
      .error {
        border-color: #f87171;
        background: rgba(248, 113, 113, 0.1);
      }
      .info {
        border-color: #60a5fa;
        background: rgba(96, 165, 250, 0.1);
      }

      button {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        margin: 5px;
        transition: all 0.3s ease;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
      }
      .result {
        margin: 15px 0;
        padding: 15px;
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.2);
      }
      .highlight {
        background: rgba(255, 255, 0, 0.2);
        padding: 2px 6px;
        border-radius: 4px;
      }
      .status-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .status-success {
        background-color: #4ade80;
      }
      .status-error {
        background-color: #f87171;
      }
      .status-warning {
        background-color: #fbbf24;
      }
      pre {
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="success-banner">
        <h1>üéâ AI Assistant - All Issues Fixed!</h1>
        <p>Testing send button, input visibility, and API responses</p>
      </div>

      <div class="test-section info">
        <h2>üîß Final Fixes Applied</h2>
        <ul>
          <li>
            <span class="status-dot status-success"></span
            ><strong>Send Button:</strong> Now shows arrow (‚Üí) instead of "Sen"
          </li>
          <li>
            <span class="status-dot status-success"></span
            ><strong>Input Visibility:</strong> Improved placeholder text
            contrast
          </li>
          <li>
            <span class="status-dot status-success"></span
            ><strong>API Responses:</strong> Fixed to give specific answers
            instead of generic responses
          </li>
          <li>
            <span class="status-dot status-success"></span
            ><strong>CSS Classes:</strong> Fixed frontend/backend integration
          </li>
        </ul>
      </div>

      <div class="test-section">
        <h2>üß™ Comprehensive Tests</h2>
        <button onclick="testSendButtonFix()">Test Send Button Fix</button>
        <button onclick="testInputVisibility()">Test Input Visibility</button>
        <button onclick="testSpecificQuestions()">
          Test Specific Questions
        </button>
        <button onclick="testFullWorkflow()">Test Full Workflow</button>
        <div id="testResults"></div>
      </div>

      <div class="test-section">
        <h2>üí¨ Manual Test</h2>
        <p>Click the AI assistant button and try these specific questions:</p>
        <ul>
          <li>
            <strong>"How do I center a div?"</strong> - Should get specific CSS
            solutions
          </li>
          <li>
            <strong>"Explain HTML semantic elements"</strong> - Should get
            detailed HTML help
          </li>
          <li>
            <strong>"JavaScript event handling basics"</strong> - Should get JS
            examples
          </li>
        </ul>
        <button onclick="openAIAssistant()">Open AI Assistant</button>
      </div>

      <div class="test-section success">
        <h2>‚úÖ Expected Results</h2>
        <ul>
          <li>
            <span class="highlight">Send Button:</span> Shows arrow (‚Üí) and is
            properly sized (48px)
          </li>
          <li>
            <span class="highlight">Input Field:</span> Clear placeholder text
            with good contrast
          </li>
          <li>
            <span class="highlight">API Responses:</span> Specific, helpful
            answers to coding questions
          </li>
          <li>
            <span class="highlight">No Errors:</span> Clean console, no
            JavaScript errors
          </li>
        </ul>
      </div>
    </div>

    <!-- AI Assistant will be injected here -->
    <script src="ai-assistant.js"></script>

    <script>
      function testSendButtonFix() {
        const resultDiv = document.getElementById("testResults");
        const sendBtn = document.getElementById("ai-send-btn");

        if (sendBtn) {
          const text = sendBtn.textContent || sendBtn.innerText;
          const styles = window.getComputedStyle(sendBtn);
          const width = parseInt(styles.width);
          const height = parseInt(styles.height);

          const isCorrectText = text.trim() === "‚Üí";
          const isCorrectSize = width >= 44 && height >= 44;
          const allGood = isCorrectText && isCorrectSize;

          resultDiv.innerHTML = `<div class="result ${
            allGood ? "success" : "error"
          }">
                    <h3><span class="status-dot ${
                      allGood ? "status-success" : "status-error"
                    }"></span>Send Button Fix Test</h3>
                    <p><strong>Button Text:</strong> "${text}" ${
            isCorrectText ? "‚úÖ" : "‚ùå"
          }</p>
                    <p><strong>Expected:</strong> "‚Üí"</p>
                    <p><strong>Size:</strong> ${width}px √ó ${height}px ${
            isCorrectSize ? "‚úÖ" : "‚ùå"
          }</p>
                    <p><strong>Expected:</strong> ‚â•44px √ó ‚â•44px</p>
                    <p><strong>Font Size:</strong> ${styles.fontSize}</p>
                    ${
                      allGood
                        ? "<p><strong>üéâ Send button is now properly fixed!</strong></p>"
                        : "<p><strong>‚ö†Ô∏è Send button still has issues.</strong></p>"
                    }
                </div>`;
        } else {
          resultDiv.innerHTML = `<div class="result error">
                    <h3><span class="status-dot status-error"></span>Send Button Not Found</h3>
                    <p>The send button element is missing. Try opening the AI assistant first.</p>
                </div>`;
        }
      }

      function testInputVisibility() {
        const resultDiv = document.getElementById("testResults");
        const input = document.getElementById("ai-input");

        if (input) {
          const styles = window.getComputedStyle(input);
          const placeholder = input.placeholder;

          // Check if placeholder is visible (not too light)
          const placeholderColor =
            styles.getPropertyValue("--placeholder-color") || "#6b7280";
          const isVisible = !placeholderColor.includes(
            "rgba(255, 255, 255, 0.5)"
          );

          resultDiv.innerHTML = `<div class="result ${
            isVisible ? "success" : "error"
          }">
                    <h3><span class="status-dot ${
                      isVisible ? "status-success" : "status-error"
                    }"></span>Input Visibility Test</h3>
                    <p><strong>Placeholder:</strong> "${placeholder}"</p>
                    <p><strong>Text Color:</strong> ${styles.color}</p>
                    <p><strong>Background:</strong> ${styles.background}</p>
                    <p><strong>Padding:</strong> ${styles.padding}</p>
                    <p><strong>Border Radius:</strong> ${
                      styles.borderRadius
                    }</p>
                    ${
                      isVisible
                        ? "<p><strong>‚úÖ Input field has good visibility!</strong></p>"
                        : "<p><strong>‚ö†Ô∏è Placeholder text might be too light.</strong></p>"
                    }
                </div>`;
        } else {
          resultDiv.innerHTML = `<div class="result error">
                    <h3><span class="status-dot status-error"></span>Input Field Not Found</h3>
                    <p>The input field element is missing. Try opening the AI assistant first.</p>
                </div>`;
        }
      }

      async function testSpecificQuestions() {
        const resultDiv = document.getElementById("testResults");
        resultDiv.innerHTML =
          '<div class="result info"><h3>üîÑ Testing Specific Questions...</h3></div>';

        const testQuestions = [
          {
            question: "How do I center a div?",
            keywords: ["center", "flexbox", "margin", "grid"],
          },
          {
            question: "Explain HTML semantic elements",
            keywords: ["header", "nav", "main", "semantic"],
          },
          {
            question: "JavaScript event handling basics",
            keywords: ["event", "listener", "click", "function"],
          },
        ];

        let results = [];

        for (const test of testQuestions) {
          try {
            const response = await fetch("/api/ai", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ message: test.question }),
            });

            const data = await response.json();

            if (data.success && data.response) {
              const responseText = data.response.toLowerCase();
              const hasKeywords = test.keywords.some((keyword) =>
                responseText.includes(keyword)
              );
              const isSpecific = responseText.length > 200 && hasKeywords;

              results.push({
                question: test.question,
                success: isSpecific,
                response: data.response,
                keywords: hasKeywords,
              });
            } else {
              results.push({
                question: test.question,
                success: false,
                error: data.error || "Unknown error",
              });
            }
          } catch (error) {
            results.push({
              question: test.question,
              success: false,
              error: error.message,
            });
          }
        }

        const allPassed = results.every((r) => r.success);

        resultDiv.innerHTML = `<div class="result ${
          allPassed ? "success" : "error"
        }">
                <h3><span class="status-dot ${
                  allPassed ? "status-success" : "status-error"
                }"></span>Specific Questions Test</h3>
                ${results
                  .map(
                    (result) => `
                    <div style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 5px;">
                        <p><strong>Q:</strong> ${result.question}</p>
                        <p><strong>Status:</strong> ${
                          result.success
                            ? "‚úÖ Specific Answer"
                            : "‚ùå " + (result.error || "Generic/Poor Response")
                        }</p>
                        ${
                          result.response
                            ? `
                            <details>
                                <summary>View Response</summary>
                                <pre style="font-size: 11px; max-height: 100px; overflow-y: auto;">${result.response.substring(
                                  0,
                                  300
                                )}...</pre>
                            </details>
                        `
                            : ""
                        }
                    </div>
                `
                  )
                  .join("")}
                ${
                  allPassed
                    ? "<p><strong>üéâ All questions get specific, helpful responses!</strong></p>"
                    : "<p><strong>‚ö†Ô∏è Some questions still get generic responses.</strong></p>"
                }
            </div>`;
      }

      async function testFullWorkflow() {
        const resultDiv = document.getElementById("testResults");
        resultDiv.innerHTML =
          '<div class="result info"><h3>üîÑ Testing Full Workflow...</h3></div>';

        let results = [];
        let allPassed = true;

        // Test 1: Send Button
        const sendBtn = document.getElementById("ai-send-btn");
        const sendBtnOk =
          sendBtn && (sendBtn.textContent || sendBtn.innerText).trim() === "‚Üí";
        results.push(
          `<span class="status-dot ${
            sendBtnOk ? "status-success" : "status-error"
          }"></span>Send Button: ${sendBtnOk ? "‚úÖ PASS" : "‚ùå FAIL"}`
        );
        if (!sendBtnOk) allPassed = false;

        // Test 2: Input Field
        const input = document.getElementById("ai-input");
        const inputOk =
          input && input.placeholder && input.placeholder.length > 0;
        results.push(
          `<span class="status-dot ${
            inputOk ? "status-success" : "status-error"
          }"></span>Input Field: ${inputOk ? "‚úÖ PASS" : "‚ùå FAIL"}`
        );
        if (!inputOk) allPassed = false;

        // Test 3: API Response
        try {
          const response = await fetch("/api/ai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: "How do I center a div?" }),
          });

          const data = await response.json();
          const apiOk =
            data.success &&
            data.response &&
            data.response.toLowerCase().includes("center");
          results.push(
            `<span class="status-dot ${
              apiOk ? "status-success" : "status-error"
            }"></span>API Response: ${apiOk ? "‚úÖ PASS" : "‚ùå FAIL"}`
          );
          if (!apiOk) allPassed = false;
        } catch (error) {
          results.push(
            `<span class="status-dot status-error"></span>API Response: ‚ùå FAIL`
          );
          allPassed = false;
        }

        // Test 4: CSS Loading
        const cssLoaded = Array.from(document.styleSheets).some((sheet) => {
          try {
            return sheet.href && sheet.href.includes("ai-assistant.css");
          } catch (e) {
            return false;
          }
        });
        results.push(
          `<span class="status-dot ${
            cssLoaded ? "status-success" : "status-error"
          }"></span>CSS Loading: ${cssLoaded ? "‚úÖ PASS" : "‚ùå FAIL"}`
        );
        if (!cssLoaded) allPassed = false;

        resultDiv.innerHTML = `<div class="result ${
          allPassed ? "success" : "error"
        }">
                <h3>${allPassed ? "üéâ" : "‚ùå"} Full Workflow Test ${
          allPassed ? "PASSED" : "FAILED"
        }</h3>
                <ul style="list-style: none; padding-left: 0;">
                    ${results.map((result) => `<li>${result}</li>`).join("")}
                </ul>
                ${
                  allPassed
                    ? "<p><strong>üéä All systems working perfectly! The AI assistant is fully functional.</strong></p>"
                    : "<p><strong>‚ö†Ô∏è Some issues detected. Check individual tests for details.</strong></p>"
                }
            </div>`;
      }

      function openAIAssistant() {
        if (
          window.aiAssistant &&
          typeof window.aiAssistant.toggleChat === "function"
        ) {
          window.aiAssistant.toggleChat();

          const resultDiv = document.getElementById("testResults");
          resultDiv.innerHTML = `<div class="result success">
                    <h3><span class="status-dot status-success"></span>AI Assistant Opened!</h3>
                    <p>The AI assistant should now be visible. Test these features:</p>
                    <ul>
                        <li><strong>Send Button:</strong> Should show arrow (‚Üí) and be 48px size</li>
                        <li><strong>Input Field:</strong> Should have clear, readable placeholder text</li>
                        <li><strong>Quick Actions:</strong> Blue buttons should be clearly visible</li>
                        <li><strong>Specific Questions:</strong> Try "How do I center a div?" for specific answer</li>
                    </ul>
                </div>`;
        } else {
          const resultDiv = document.getElementById("testResults");
          resultDiv.innerHTML = `<div class="result error">
                    <h3><span class="status-dot status-error"></span>AI Assistant Not Available</h3>
                    <p>The AI assistant JavaScript is not properly loaded.</p>
                </div>`;
        }
      }

      // Auto-run tests when page loads
      window.addEventListener("load", () => {
        setTimeout(() => {
          testFullWorkflow();
        }, 2000);
      });

      // Log final fix status
      console.log("üéâ Final AI Assistant Fix Test");
      console.log("‚úÖ Send button fixed");
      console.log("‚úÖ Input visibility improved");
      console.log("‚úÖ API responses fixed");
      console.log("‚úÖ All issues resolved");
    </script>
  </body>
</html>
