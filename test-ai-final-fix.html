<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Assistant Final Fix Test</title>
    <link rel="stylesheet" href="ai-assistant.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .success {
        border-color: #4ade80;
        background: rgba(74, 222, 128, 0.1);
      }
      .error {
        border-color: #f87171;
        background: rgba(248, 113, 113, 0.1);
      }
      .info {
        border-color: #60a5fa;
        background: rgba(96, 165, 250, 0.1);
      }

      button {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        margin: 5px;
        transition: all 0.3s ease;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
      }
      .result {
        margin: 15px 0;
        padding: 15px;
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.2);
      }
      .highlight {
        background: rgba(255, 255, 0, 0.2);
        padding: 2px 6px;
        border-radius: 4px;
      }
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .status-success {
        background-color: #4ade80;
      }
      .status-error {
        background-color: #f87171;
      }
      .status-warning {
        background-color: #fbbf24;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🤖 AI Assistant Final Fix Verification</h1>
      <p>
        Testing all fixes: API endpoint, button styling, and error handling.
      </p>

      <div class="test-section info">
        <h2>🔧 Fixes Applied</h2>
        <ul>
          <li>
            <span class="status-indicator status-success"></span
            ><strong>API Endpoint:</strong> Changed from
            <code>api/ai.php</code> to <code>/api/ai</code>
          </li>
          <li>
            <span class="status-indicator status-success"></span
            ><strong>Quick Action Buttons:</strong> Blue background with white
            text
          </li>
          <li>
            <span class="status-indicator status-success"></span
            ><strong>Send Button:</strong> Enhanced styling with shadows and
            animations
          </li>
          <li>
            <span class="status-indicator status-success"></span
            ><strong>Error Handling:</strong> Comprehensive logging and
            user-friendly messages
          </li>
        </ul>
      </div>

      <div class="test-section">
        <h2>🧪 Automated Tests</h2>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="testAPIEndpoint()">Test API Only</button>
        <button onclick="testUIComponents()">Test UI Only</button>
        <div id="testResults"></div>
      </div>

      <div class="test-section">
        <h2>💬 Manual Test</h2>
        <p>
          Click the AI assistant button in the bottom-right corner and try
          these:
        </p>
        <ul>
          <li>
            <strong>Quick Actions:</strong> Click the blue suggestion buttons
          </li>
          <li>
            <strong>Send Message:</strong> Type "How do I center a div?" and
            send
          </li>
          <li>
            <strong>Check Styling:</strong> Verify buttons are clearly visible
          </li>
        </ul>
        <button onclick="openAIAssistant()">Open AI Assistant</button>
      </div>

      <div class="test-section success">
        <h2>✅ Expected Results</h2>
        <ul>
          <li>
            <span class="highlight">No 404 errors</span> - API calls should work
          </li>
          <li>
            <span class="highlight">Blue quick action buttons</span> - Clearly
            visible with white text
          </li>
          <li>
            <span class="highlight">Enhanced send button</span> - Larger with
            smooth animations
          </li>
          <li>
            <span class="highlight">AI responses</span> - Helpful coding
            assistance
          </li>
        </ul>
      </div>
    </div>

    <!-- AI Assistant will be injected here -->
    <script src="ai-assistant.js"></script>

    <script>
      async function testAPIEndpoint() {
        const resultDiv = document.getElementById("testResults");
        resultDiv.innerHTML =
          '<div class="result info"><h3>🔄 Testing API Endpoint...</h3></div>';

        try {
          console.log("Testing /api/ai endpoint...");

          const response = await fetch("/api/ai", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: "Test message - how do I create a responsive layout?",
            }),
          });

          console.log("API Response:", response.status, response.statusText);

          if (!response.ok) {
            const errorText = await response.text();
            console.error("API Error:", errorText);
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          console.log("API Data:", data);

          if (data.success && data.response) {
            resultDiv.innerHTML = `<div class="result success">
                        <h3><span class="status-indicator status-success"></span>API Endpoint Working!</h3>
                        <p><strong>Status:</strong> ${response.status} OK</p>
                        <p><strong>Source:</strong> ${data.source}</p>
                        <p><strong>Response Length:</strong> ${
                          data.response.length
                        } characters</p>
                        <p><strong>Preview:</strong> ${data.response.substring(
                          0,
                          100
                        )}...</p>
                    </div>`;
          } else {
            throw new Error("Invalid response format");
          }
        } catch (error) {
          console.error("API Test failed:", error);
          resultDiv.innerHTML = `<div class="result error">
                    <h3><span class="status-indicator status-error"></span>API Test Failed</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check browser console for details.</p>
                </div>`;
        }
      }

      function testUIComponents() {
        const resultDiv = document.getElementById("testResults");

        // Check AI assistant components
        const aiWidget = document.querySelector(".ai-assistant-widget");
        const aiButton = document.querySelector(".ai-toggle-button");
        const quickActions = document.querySelectorAll(".quick-action-btn");
        const sendButton = document.querySelector("#ai-send-btn");

        let results = [];

        // Test AI Widget
        if (aiWidget) {
          results.push(
            '<span class="status-indicator status-success"></span>AI Widget: Found'
          );
        } else {
          results.push(
            '<span class="status-indicator status-error"></span>AI Widget: Missing'
          );
        }

        // Test AI Button
        if (aiButton) {
          const styles = window.getComputedStyle(aiButton);
          results.push(
            '<span class="status-indicator status-success"></span>AI Button: Found'
          );
          results.push(`&nbsp;&nbsp;Background: ${styles.background}`);
        } else {
          results.push(
            '<span class="status-indicator status-error"></span>AI Button: Missing'
          );
        }

        // Test Quick Action Buttons
        if (quickActions.length > 0) {
          const firstBtn = quickActions[0];
          const styles = window.getComputedStyle(firstBtn);
          const bgColor = styles.backgroundColor;

          results.push(
            `<span class="status-indicator status-success"></span>Quick Actions: Found (${quickActions.length})`
          );
          results.push(`&nbsp;&nbsp;Background: ${bgColor}`);

          // Check if it's blue
          if (
            bgColor.includes("99, 102, 241") ||
            bgColor.includes("#6366f1") ||
            bgColor === "rgb(99, 102, 241)"
          ) {
            results.push(
              '<span class="status-indicator status-success"></span>&nbsp;&nbsp;Styling: Blue background ✓'
            );
          } else {
            results.push(
              '<span class="status-indicator status-warning"></span>&nbsp;&nbsp;Styling: Not blue background'
            );
          }
        } else {
          results.push(
            '<span class="status-indicator status-error"></span>Quick Actions: Missing'
          );
        }

        // Test Send Button
        if (sendButton) {
          const styles = window.getComputedStyle(sendButton);
          results.push(
            '<span class="status-indicator status-success"></span>Send Button: Found'
          );
          results.push(`&nbsp;&nbsp;Size: ${styles.width} x ${styles.height}`);
          results.push(
            `&nbsp;&nbsp;Box Shadow: ${
              styles.boxShadow !== "none" ? "Yes" : "No"
            }`
          );
        } else {
          results.push(
            '<span class="status-indicator status-error"></span>Send Button: Missing'
          );
        }

        const allGood =
          aiWidget && aiButton && quickActions.length > 0 && sendButton;

        resultDiv.innerHTML = `<div class="result ${
          allGood ? "success" : "error"
        }">
                <h3>${allGood ? "✅" : "❌"} UI Components Test</h3>
                <ul style="list-style: none; padding-left: 0;">
                    ${results.map((result) => `<li>${result}</li>`).join("")}
                </ul>
                ${
                  allGood
                    ? "<p><strong>All UI components are properly styled!</strong></p>"
                    : "<p><strong>Some UI components need attention.</strong></p>"
                }
            </div>`;
      }

      async function runAllTests() {
        const resultDiv = document.getElementById("testResults");
        resultDiv.innerHTML =
          '<div class="result info"><h3>🔄 Running All Tests...</h3></div>';

        // Test API first
        await testAPIEndpoint();

        // Wait a moment then test UI
        setTimeout(() => {
          const currentResult = resultDiv.innerHTML;
          testUIComponents();
          const uiResult = resultDiv.innerHTML;

          // Combine results
          resultDiv.innerHTML = currentResult + uiResult;
        }, 1000);
      }

      function openAIAssistant() {
        if (
          window.aiAssistant &&
          typeof window.aiAssistant.toggleChat === "function"
        ) {
          window.aiAssistant.toggleChat();
        } else {
          alert("AI Assistant not available. Check console for errors.");
        }
      }

      // Auto-run tests when page loads
      window.addEventListener("load", () => {
        setTimeout(() => {
          runAllTests();
        }, 1500);
      });

      // Log when AI assistant is ready
      document.addEventListener("DOMContentLoaded", () => {
        console.log("🤖 AI Assistant Final Fix Test Page Loaded");
        console.log("✅ Testing API endpoint: /api/ai");
        console.log("✅ Testing UI improvements");
        console.log("👀 Look for the AI button in bottom-right corner!");
      });
    </script>
  </body>
</html>
