<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complete Editor Functionality Test</title>
    <link rel="stylesheet" href="public/styles.css" />
    <link rel="stylesheet" href="public/game-editor-styles.css" />
    <style>
      .test-section {
        background: #f8f9fa;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        border-left: 4px solid #007bff;
      }
      .test-section.success {
        border-left-color: #28a745;
        background: #d4edda;
      }
      .test-section.error {
        border-left-color: #dc3545;
        background: #f8d7da;
      }
      .functionality-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .functionality-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border: 1px solid #ddd;
      }
      .functionality-card h3 {
        margin-top: 0;
        color: #333;
      }
      .method-list {
        list-style: none;
        padding: 0;
      }
      .method-list li {
        padding: 5px 0;
        border-bottom: 1px solid #eee;
      }
      .method-list li:last-child {
        border-bottom: none;
      }
      .method-name {
        font-family: monospace;
        background: #f1f1f1;
        padding: 2px 6px;
        border-radius: 3px;
        font-weight: bold;
      }
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .status-indicator.success {
        background: #28a745;
      }
      .status-indicator.error {
        background: #dc3545;
      }
      .btn {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        text-decoration: none;
        display: inline-block;
      }
      .btn:hover {
        background: #0056b3;
      }
      .btn-success {
        background: #28a745;
      }
      .btn-warning {
        background: #ffc107;
        color: #212529;
      }
      .btn-danger {
        background: #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🧪 Complete Editor Functionality Test</h1>

      <div id="overall-status" class="test-section">
        <h3>Overall Status</h3>
        <div id="status-message">Testing in progress...</div>
      </div>

      <div class="functionality-grid">
        <!-- Core Editor Functionality -->
        <div class="functionality-card">
          <h3>🔧 Core Editor</h3>
          <ul class="method-list" id="core-methods">
            <li>
              <span class="status-indicator" id="status-init"></span
              ><span class="method-name">init()</span>
            </li>
            <li>
              <span
                class="status-indicator"
                id="status-setupEventListeners"
              ></span
              ><span class="method-name">setupEventListeners()</span>
            </li>
            <li>
              <span
                class="status-indicator"
                id="status-initializeSimpleEditor"
              ></span
              ><span class="method-name">initializeSimpleEditor()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-switchTab"></span
              ><span class="method-name">switchTab()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-updatePreview"></span
              ><span class="method-name">updatePreview()</span>
            </li>
          </ul>
        </div>

        <!-- Game Functionality -->
        <div class="functionality-card">
          <h3>🎮 Game System</h3>
          <ul class="method-list" id="game-methods">
            <li>
              <span class="status-indicator" id="status-checkForGame"></span
              ><span class="method-name">checkForGame()</span>
            </li>
            <li>
              <span
                class="status-indicator"
                id="status-loadGameInstructions"
              ></span
              ><span class="method-name">loadGameInstructions()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-setupGameMode"></span
              ><span class="method-name">setupGameMode()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-startGameTimer"></span
              ><span class="method-name">startGameTimer()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-submitGame"></span
              ><span class="method-name">submitGame()</span>
            </li>
            <li>
              <span
                class="status-indicator"
                id="status-showGameCompletionModal"
              ></span
              ><span class="method-name">showGameCompletionModal()</span>
            </li>
          </ul>
        </div>

        <!-- Challenge Functionality -->
        <div class="functionality-card">
          <h3>🎯 Challenge System</h3>
          <ul class="method-list" id="challenge-methods">
            <li>
              <span
                class="status-indicator"
                id="status-checkForChallenge"
              ></span
              ><span class="method-name">checkForChallenge()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-loadChallenge"></span
              ><span class="method-name">loadChallenge()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-displayChallenge"></span
              ><span class="method-name">displayChallenge()</span>
            </li>
            <li>
              <span
                class="status-indicator"
                id="status-displayTestStatements"
              ></span
              ><span class="method-name">displayTestStatements()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-loadStarterCode"></span
              ><span class="method-name">loadStarterCode()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-submitChallenge"></span
              ><span class="method-name">submitChallenge()</span>
            </li>
            <li>
              <span
                class="status-indicator"
                id="status-displayTestResults"
              ></span
              ><span class="method-name">displayTestResults()</span>
            </li>
          </ul>
        </div>

        <!-- Lesson Functionality -->
        <div class="functionality-card">
          <h3>📚 Lesson System</h3>
          <ul class="method-list" id="lesson-methods">
            <li>
              <span class="status-indicator" id="status-checkForLesson"></span
              ><span class="method-name">checkForLesson()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-loadLesson"></span
              ><span class="method-name">loadLesson()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-displayLesson"></span
              ><span class="method-name">displayLesson()</span>
            </li>
            <li>
              <span
                class="status-indicator"
                id="status-displayLearningObjectives"
              ></span
              ><span class="method-name">displayLearningObjectives()</span>
            </li>
            <li>
              <span
                class="status-indicator"
                id="status-loadLessonStarterCode"
              ></span
              ><span class="method-name">loadLessonStarterCode()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-completeLesson"></span
              ><span class="method-name">completeLesson()</span>
            </li>
            <li>
              <span class="status-indicator" id="status-markdownToHtml"></span
              ><span class="method-name">markdownToHtml()</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="test-section">
        <h3>🧪 Test Actions</h3>
        <button class="btn" onclick="runAllTests()">Run All Tests</button>
        <button class="btn btn-success" onclick="testGameMode()">
          Test Game Mode
        </button>
        <button class="btn btn-warning" onclick="testChallengeMode()">
          Test Challenge Mode
        </button>
        <button class="btn btn-danger" onclick="testLessonMode()">
          Test Lesson Mode
        </button>
      </div>

      <div id="test-results" class="test-section" style="display: none">
        <h3>📊 Test Results</h3>
        <div id="results-content"></div>
      </div>

      <!-- Hidden editor elements for testing -->
      <div style="display: none">
        <div id="challengeTitle">Test Title</div>
        <div id="challengeDescription">Test Description</div>
        <div id="testStatements"><ul></ul></div>
        <div id="gameInstructions"></div>
        <div id="lessonInstructions"></div>
        <div id="lessonContent"></div>
        <div id="learningObjectives"><ul></ul></div>
        <div id="testResults"></div>
        <div id="html-monaco"></div>
        <div id="css-monaco"></div>
        <div id="js-monaco"></div>
      </div>
    </div>

    <script src="public/editor.js"></script>
    <script>
      let testEditor;
      let testResults = {
        core: 0,
        game: 0,
        challenge: 0,
        lesson: 0,
        total: 0,
      };

      function updateStatus(methodName, success) {
        const indicator = document.getElementById(`status-${methodName}`);
        if (indicator) {
          indicator.className = `status-indicator ${
            success ? "success" : "error"
          }`;
        }

        if (success) {
          testResults.total++;

          // Update category counts
          if (
            [
              "init",
              "setupEventListeners",
              "initializeSimpleEditor",
              "switchTab",
              "updatePreview",
            ].includes(methodName)
          ) {
            testResults.core++;
          } else if (
            methodName.includes("Game") ||
            methodName.includes("game")
          ) {
            testResults.game++;
          } else if (
            methodName.includes("Challenge") ||
            methodName.includes("challenge")
          ) {
            testResults.challenge++;
          } else if (
            methodName.includes("Lesson") ||
            methodName.includes("lesson") ||
            methodName.includes("markdown")
          ) {
            testResults.lesson++;
          }
        }
      }

      function runAllTests() {
        console.log("🧪 Starting comprehensive functionality tests...");

        try {
          // Test CodeEditor class exists
          if (typeof CodeEditor !== "undefined") {
            console.log("✅ CodeEditor class is defined");

            // Create test instance
            testEditor = new CodeEditor();
            console.log("✅ CodeEditor instance created");

            // Test core methods
            testCoreMethods();
            testGameMethods();
            testChallengeMethods();
            testLessonMethods();

            updateOverallStatus();
            showResults();
          } else {
            throw new Error("CodeEditor class not found");
          }
        } catch (error) {
          console.error("❌ Test failed:", error);
          document.getElementById("status-message").innerHTML = `
                    <strong>❌ Tests Failed:</strong> ${error.message}
                `;
          document.getElementById("overall-status").className =
            "test-section error";
        }
      }

      function testCoreMethods() {
        console.log("Testing core methods...");

        updateStatus("init", typeof testEditor.init === "function");
        updateStatus(
          "setupEventListeners",
          typeof testEditor.setupEventListeners === "function"
        );
        updateStatus(
          "initializeSimpleEditor",
          typeof testEditor.initializeSimpleEditor === "function"
        );
        updateStatus("switchTab", typeof testEditor.switchTab === "function");
        updateStatus(
          "updatePreview",
          typeof testEditor.updatePreview === "function"
        );
      }

      function testGameMethods() {
        console.log("Testing game methods...");

        updateStatus(
          "checkForGame",
          typeof testEditor.checkForGame === "function"
        );
        updateStatus(
          "loadGameInstructions",
          typeof testEditor.loadGameInstructions === "function"
        );
        updateStatus(
          "setupGameMode",
          typeof testEditor.setupGameMode === "function"
        );
        updateStatus(
          "startGameTimer",
          typeof testEditor.startGameTimer === "function"
        );
        updateStatus("submitGame", typeof testEditor.submitGame === "function");
        updateStatus(
          "showGameCompletionModal",
          typeof testEditor.showGameCompletionModal === "function"
        );
      }

      function testChallengeMethods() {
        console.log("Testing challenge methods...");

        updateStatus(
          "checkForChallenge",
          typeof testEditor.checkForChallenge === "function"
        );
        updateStatus(
          "loadChallenge",
          typeof testEditor.loadChallenge === "function"
        );
        updateStatus(
          "displayChallenge",
          typeof testEditor.displayChallenge === "function"
        );
        updateStatus(
          "displayTestStatements",
          typeof testEditor.displayTestStatements === "function"
        );
        updateStatus(
          "loadStarterCode",
          typeof testEditor.loadStarterCode === "function"
        );
        updateStatus(
          "submitChallenge",
          typeof testEditor.submitChallenge === "function"
        );
        updateStatus(
          "displayTestResults",
          typeof testEditor.displayTestResults === "function"
        );
      }

      function testLessonMethods() {
        console.log("Testing lesson methods...");

        updateStatus(
          "checkForLesson",
          typeof testEditor.checkForLesson === "function"
        );
        updateStatus("loadLesson", typeof testEditor.loadLesson === "function");
        updateStatus(
          "displayLesson",
          typeof testEditor.displayLesson === "function"
        );
        updateStatus(
          "displayLearningObjectives",
          typeof testEditor.displayLearningObjectives === "function"
        );
        updateStatus(
          "loadLessonStarterCode",
          typeof testEditor.loadLessonStarterCode === "function"
        );
        updateStatus(
          "completeLesson",
          typeof testEditor.completeLesson === "function"
        );
        updateStatus(
          "markdownToHtml",
          typeof testEditor.markdownToHtml === "function"
        );
      }

      function updateOverallStatus() {
        const totalMethods = 25; // Total expected methods
        const successRate = ((testResults.total / totalMethods) * 100).toFixed(
          1
        );

        const statusElement = document.getElementById("overall-status");
        const messageElement = document.getElementById("status-message");

        if (testResults.total === totalMethods) {
          statusElement.className = "test-section success";
          messageElement.innerHTML = `
                    <strong>🎉 All Tests Passed!</strong><br>
                    ✅ ${testResults.total}/${totalMethods} methods available (${successRate}%)
                `;
        } else {
          statusElement.className = "test-section error";
          messageElement.innerHTML = `
                    <strong>⚠️ Some Tests Failed</strong><br>
                    ✅ ${testResults.total}/${totalMethods} methods available (${successRate}%)
                `;
        }
      }

      function showResults() {
        const resultsDiv = document.getElementById("test-results");
        const contentDiv = document.getElementById("results-content");

        contentDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h4>🔧 Core Editor</h4>
                        <div style="font-size: 24px; font-weight: bold; color: #007bff;">${
                          testResults.core
                        }/5</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h4>🎮 Game System</h4>
                        <div style="font-size: 24px; font-weight: bold; color: #28a745;">${
                          testResults.game
                        }/6</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h4>🎯 Challenge System</h4>
                        <div style="font-size: 24px; font-weight: bold; color: #ffc107;">${
                          testResults.challenge
                        }/7</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h4>📚 Lesson System</h4>
                        <div style="font-size: 24px; font-weight: bold; color: #dc3545;">${
                          testResults.lesson
                        }/7</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 8px;">
                    <h4>📊 Summary</h4>
                    <p><strong>Total Methods:</strong> ${
                      testResults.total
                    }/25</p>
                    <p><strong>Success Rate:</strong> ${(
                      (testResults.total / 25) *
                      100
                    ).toFixed(1)}%</p>
                    <p><strong>Status:</strong> ${
                      testResults.total === 25
                        ? "🎉 All functionality restored!"
                        : "⚠️ Some functionality missing"
                    }</p>
                </div>
            `;

        resultsDiv.style.display = "block";
      }

      function testGameMode() {
        window.location.href = "editor.html?game=test-game";
      }

      function testChallengeMode() {
        window.location.href = "editor.html?challenge=test-challenge";
      }

      function testLessonMode() {
        window.location.href = "editor.html?lesson=test-lesson";
      }

      // Auto-run tests when page loads
      window.addEventListener("load", () => {
        setTimeout(runAllTests, 1000);
      });
    </script>
  </body>
</html>
