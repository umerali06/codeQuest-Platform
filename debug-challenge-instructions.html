<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Challenge Instructions</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .debug-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .log-entry {
        padding: 8px;
        margin: 5px 0;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
      }
      .log-info {
        background: #e3f2fd;
        color: #1565c0;
      }
      .log-success {
        background: #e8f5e8;
        color: #2e7d32;
      }
      .log-error {
        background: #ffebee;
        color: #c62828;
      }
      .log-warning {
        background: #fff3e0;
        color: #ef6c00;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background-color: #0056b3;
      }
      .element-check {
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .found {
        background: #d4edda;
        border-color: #c3e6cb;
      }
      .not-found {
        background: #f8d7da;
        border-color: #f5c6cb;
      }
    </style>
  </head>
  <body>
    <div class="debug-container">
      <h1>üîç Challenge Instructions Debug</h1>
      <p>
        This tool helps debug why challenge instructions aren't showing in the
        editor.
      </p>

      <button onclick="testChallengeAPI()">Test Challenge API</button>
      <button onclick="testDOMElements()">Test DOM Elements</button>
      <button onclick="testChallengeFlow()">Test Full Challenge Flow</button>
      <button onclick="clearLogs()">Clear Logs</button>

      <div id="debugLogs"></div>
      <div id="elementChecks"></div>
    </div>

    <script>
      const API_BASE = "http://localhost:8000/api";

      function log(message, type = "info") {
        const logsDiv = document.getElementById("debugLogs");
        const logEntry = document.createElement("div");
        logEntry.className = `log-entry log-${type}`;
        logEntry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
        logsDiv.appendChild(logEntry);
        logsDiv.scrollTop = logsDiv.scrollHeight;
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      function clearLogs() {
        document.getElementById("debugLogs").innerHTML = "";
        document.getElementById("elementChecks").innerHTML = "";
      }

      async function testChallengeAPI() {
        log("üîå Testing Challenge API...", "info");

        try {
          // Test the contact-card challenge specifically
          const response = await fetch(`${API_BASE}/challenges/contact-card`);
          log(
            `API Response Status: ${response.status}`,
            response.ok ? "success" : "error"
          );

          if (response.ok) {
            const result = await response.json();
            log(
              `API Success: ${result.success}`,
              result.success ? "success" : "error"
            );

            if (result.success && result.data) {
              const challenge = result.data;
              log(`Challenge Title: ${challenge.title}`, "success");
              log(
                `Challenge Description: ${
                  challenge.description ? "Present" : "Missing"
                }`,
                challenge.description ? "success" : "warning"
              );
              log(
                `Challenge Instructions: ${
                  challenge.instructions ? "Present" : "Missing"
                }`,
                challenge.instructions ? "success" : "warning"
              );
              log(
                `Challenge Tests: ${
                  challenge.tests
                    ? challenge.tests.length + " tests"
                    : "No tests"
                }`,
                challenge.tests ? "success" : "warning"
              );

              // Store for later use
              window.testChallenge = challenge;
              log(
                "‚úÖ Challenge data stored in window.testChallenge",
                "success"
              );
            } else {
              log("‚ùå No challenge data in response", "error");
            }
          } else {
            const errorText = await response.text();
            log(`API Error: ${errorText}`, "error");
          }
        } catch (error) {
          log(`API Exception: ${error.message}`, "error");
        }
      }

      function testDOMElements() {
        log("üé® Testing DOM Elements...", "info");

        const elementsToCheck = [
          "challengeTitle",
          "challengeDifficulty",
          "challengeXP",
          "defaultDescription",
          "challengeDescriptionContent",
          "challengeDescription",
        ];

        const checksDiv = document.getElementById("elementChecks");
        checksDiv.innerHTML = "<h3>DOM Element Checks:</h3>";

        elementsToCheck.forEach((elementId) => {
          const element = document.getElementById(elementId);
          const checkDiv = document.createElement("div");
          checkDiv.className = `element-check ${
            element ? "found" : "not-found"
          }`;
          checkDiv.innerHTML = `
                    <strong>${elementId}:</strong> ${
            element ? "‚úÖ Found" : "‚ùå Not Found"
          }
                    ${
                      element
                        ? `<br><small>Tag: ${element.tagName}, Classes: ${
                            element.className || "none"
                          }</small>`
                        : ""
                    }
                `;
          checksDiv.appendChild(checkDiv);

          log(
            `Element ${elementId}: ${element ? "Found" : "Not Found"}`,
            element ? "success" : "error"
          );
        });
      }

      async function testChallengeFlow() {
        log("üîÑ Testing Full Challenge Flow...", "info");

        // Step 1: Check URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const challengeParam = urlParams.get("challenge");
        log(
          `URL Challenge Parameter: ${challengeParam || "Not found"}`,
          challengeParam ? "success" : "warning"
        );

        // Step 2: Test API call
        if (!window.testChallenge) {
          log("No challenge data available, testing API first...", "warning");
          await testChallengeAPI();
        }

        if (window.testChallenge) {
          log("‚úÖ Challenge data available, testing display...", "success");

          // Step 3: Test DOM elements
          const challengeTitle = document.getElementById("challengeTitle");
          const challengeDescriptionContent = document.getElementById(
            "challengeDescriptionContent"
          );
          const defaultDescription =
            document.getElementById("defaultDescription");

          if (challengeTitle) {
            challengeTitle.textContent = `üéØ ${window.testChallenge.title}`;
            log("‚úÖ Updated challenge title", "success");
          } else {
            log("‚ùå challengeTitle element not found", "error");
          }

          if (defaultDescription) {
            defaultDescription.style.display = "none";
            log("‚úÖ Hidden default description", "success");
          } else {
            log("‚ùå defaultDescription element not found", "error");
          }

          if (challengeDescriptionContent) {
            challengeDescriptionContent.style.display = "block";
            challengeDescriptionContent.innerHTML = `
                        <div class="challenge-info">
                            <div class="challenge-description-text">
                                <h3>üéØ Challenge Description</h3>
                                <p>${window.testChallenge.description}</p>
                            </div>
                            <div class="challenge-instructions">
                                <h3>üìã Instructions</h3>
                                <div class="instructions-content">
                                    ${window.testChallenge.instructions}
                                </div>
                            </div>
                            <div class="challenge-metadata">
                                <p><strong>Difficulty:</strong> ${window.testChallenge.difficulty}</p>
                                <p><strong>XP Reward:</strong> ${window.testChallenge.xpReward} points</p>
                                <p><strong>Category:</strong> ${window.testChallenge.category}</p>
                            </div>
                        </div>
                    `;
            log("‚úÖ Updated challenge description content", "success");
          } else {
            log("‚ùå challengeDescriptionContent element not found", "error");
          }

          // Step 4: Test starter code loading
          if (window.testChallenge.starterCode) {
            log("‚úÖ Starter code available", "success");
            log(
              `HTML Starter: ${
                window.testChallenge.starterCode.html ? "Present" : "Missing"
              }`,
              "info"
            );
            log(
              `CSS Starter: ${
                window.testChallenge.starterCode.css ? "Present" : "Missing"
              }`,
              "info"
            );
            log(
              `JS Starter: ${
                window.testChallenge.starterCode.js ? "Present" : "Missing"
              }`,
              "info"
            );
          } else {
            log("‚ö†Ô∏è No starter code available", "warning");
          }
        } else {
          log("‚ùå No challenge data available for testing", "error");
        }
      }

      // Auto-run basic tests when page loads
      window.addEventListener("DOMContentLoaded", () => {
        log("üöÄ Debug tool loaded. Click buttons to run tests.", "info");

        // Check if we're in the editor context
        if (window.location.pathname.includes("editor")) {
          log("üìç Running in editor context", "info");
        } else {
          log("üìç Running in standalone debug mode", "warning");
        }
      });
    </script>
  </body>
</html>
