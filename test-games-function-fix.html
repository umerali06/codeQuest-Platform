<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Games API - Function Fix</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #1a1a1a;
        color: #fff;
      }
      .test-section {
        background: #2a2a2a;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        border: 1px solid #444;
      }
      .success {
        color: #4caf50;
      }
      .error {
        color: #f44336;
      }
      .info {
        color: #2196f3;
      }
      pre {
        background: #333;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        white-space: pre-wrap;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #45a049;
      }
    </style>
  </head>
  <body>
    <h1>Test Games API - Function Redeclaration Fix</h1>

    <div class="test-section">
      <h2>API Test Results</h2>
      <div id="results"></div>
      <button onclick="testGamesAPI()">Test Games API</button>
      <button onclick="testDirectAPI()">Test Direct API Call</button>
    </div>

    <script>
      async function testGamesAPI() {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = '<div class="info">Testing Games API...</div>';

        try {
          const response = await fetch("/api/games", {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
            },
          });

          console.log("Response status:", response.status);
          console.log("Response headers:", response.headers);

          const responseText = await response.text();
          console.log("Raw response:", responseText);

          if (
            responseText.includes("Fatal error") ||
            responseText.includes("Cannot redeclare")
          ) {
            resultsDiv.innerHTML = `
                        <div class="error">❌ Function redeclaration error still exists!</div>
                        <pre>${responseText}</pre>
                    `;
            return;
          }

          let data;
          try {
            data = JSON.parse(responseText);
          } catch (parseError) {
            resultsDiv.innerHTML = `
                        <div class="error">❌ JSON Parse Error: ${parseError.message}</div>
                        <pre>Response: ${responseText}</pre>
                    `;
            return;
          }

          if (data.success) {
            resultsDiv.innerHTML = `
                        <div class="success">✅ Games API working correctly!</div>
                        <div class="info">Found ${
                          data.data ? data.data.length : 0
                        } games</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          } else {
            resultsDiv.innerHTML = `
                        <div class="error">❌ API returned error: ${
                          data.error || "Unknown error"
                        }</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          }
        } catch (error) {
          resultsDiv.innerHTML = `
                    <div class="error">❌ Network Error: ${error.message}</div>
                `;
          console.error("Test error:", error);
        }
      }

      async function testDirectAPI() {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML =
          '<div class="info">Testing Direct API Call...</div>';

        try {
          const response = await fetch("/codeQuest-Platform/api/games.php", {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
            },
          });

          const responseText = await response.text();
          console.log("Direct API response:", responseText);

          if (
            responseText.includes("Fatal error") ||
            responseText.includes("Cannot redeclare")
          ) {
            resultsDiv.innerHTML = `
                        <div class="error">❌ Direct API call failed with function error!</div>
                        <pre>${responseText}</pre>
                    `;
            return;
          }

          try {
            const data = JSON.parse(responseText);
            resultsDiv.innerHTML = `
                        <div class="success">✅ Direct API call successful!</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          } catch (parseError) {
            resultsDiv.innerHTML = `
                        <div class="error">❌ JSON Parse Error: ${parseError.message}</div>
                        <pre>Response: ${responseText}</pre>
                    `;
          }
        } catch (error) {
          resultsDiv.innerHTML = `
                    <div class="error">❌ Network Error: ${error.message}</div>
                `;
          console.error("Direct test error:", error);
        }
      }

      // Auto-test on page load
      window.addEventListener("load", () => {
        setTimeout(testGamesAPI, 1000);
      });
    </script>
  </body>
</html>
