<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clear Challenge localStorage</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        border-color: #bee5eb;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>üßπ Clear Challenge localStorage</h1>

    <div class="section info">
      <h2>Issue</h2>
      <p>
        The editor is trying to load "Style Your HTML" challenge which doesn't
        exist, likely from localStorage.
      </p>
    </div>

    <div class="section">
      <h2>Current localStorage Values</h2>
      <button onclick="checkLocalStorage()">Check localStorage</button>
      <div id="localStorageResult"></div>
    </div>

    <div class="section">
      <h2>Clear Challenge Data</h2>
      <button onclick="clearChallengeData()">
        Clear Challenge localStorage
      </button>
      <button onclick="clearAllCodeQuestData()">
        Clear All CodeQuest Data
      </button>
      <div id="clearResult"></div>
    </div>

    <div class="section">
      <h2>Test Editor</h2>
      <button onclick="testEditor()">
        Open Editor (Should Not Load Any Challenge)
      </button>
      <button onclick="testEditorWithValidChallenge()">
        Open Editor with Valid Challenge
      </button>
      <div id="editorResult"></div>
    </div>

    <script>
      function checkLocalStorage() {
        const resultDiv = document.getElementById("localStorageResult");

        const challengeData = localStorage.getItem(
          "codequest_current_challenge"
        );
        const completedChallenges = localStorage.getItem(
          "codequest_completed_challenges"
        );
        const userProgress = localStorage.getItem("codequest_user_progress");

        let html = "<h3>Current localStorage Values:</h3><ul>";

        if (challengeData) {
          html += `<li><strong>codequest_current_challenge:</strong> "${challengeData}"</li>`;
        } else {
          html +=
            "<li><strong>codequest_current_challenge:</strong> (not set)</li>";
        }

        if (completedChallenges) {
          html += `<li><strong>codequest_completed_challenges:</strong> ${completedChallenges}</li>`;
        } else {
          html +=
            "<li><strong>codequest_completed_challenges:</strong> (not set)</li>";
        }

        if (userProgress) {
          html += `<li><strong>codequest_user_progress:</strong> ${userProgress.substring(
            0,
            100
          )}...</li>`;
        } else {
          html +=
            "<li><strong>codequest_user_progress:</strong> (not set)</li>";
        }

        html += "</ul>";

        // Check all localStorage keys for CodeQuest
        const allKeys = Object.keys(localStorage).filter(
          (key) => key.includes("codequest") || key.includes("CodeQuest")
        );
        if (allKeys.length > 0) {
          html += "<h4>All CodeQuest localStorage keys:</h4><ul>";
          allKeys.forEach((key) => {
            const value = localStorage.getItem(key);
            html += `<li><strong>${key}:</strong> ${
              value ? value.substring(0, 50) + "..." : "(empty)"
            }</li>`;
          });
          html += "</ul>";
        }

        resultDiv.innerHTML = html;
      }

      function clearChallengeData() {
        const resultDiv = document.getElementById("clearResult");

        try {
          localStorage.removeItem("codequest_current_challenge");
          resultDiv.innerHTML =
            '<div class="success"><h3>‚úÖ Cleared codequest_current_challenge</h3><p>The editor should no longer try to load "Style Your HTML"</p></div>';
        } catch (error) {
          resultDiv.innerHTML = `<div class="error"><h3>‚ùå Error:</h3><p>${error.message}</p></div>`;
        }
      }

      function clearAllCodeQuestData() {
        const resultDiv = document.getElementById("clearResult");

        try {
          const keys = Object.keys(localStorage).filter(
            (key) => key.includes("codequest") || key.includes("CodeQuest")
          );

          keys.forEach((key) => localStorage.removeItem(key));

          resultDiv.innerHTML = `<div class="success"><h3>‚úÖ Cleared ${keys.length} CodeQuest localStorage items</h3><p>All CodeQuest data has been reset</p></div>`;
        } catch (error) {
          resultDiv.innerHTML = `<div class="error"><h3>‚ùå Error:</h3><p>${error.message}</p></div>`;
        }
      }

      function testEditor() {
        const resultDiv = document.getElementById("editorResult");
        resultDiv.innerHTML = `<div class="info">
                <h3>üîó Opening Editor</h3>
                <p>Should open without trying to load any challenge.</p>
                <p><a href="editor.html" target="_blank">Open Editor ‚Üí</a></p>
            </div>`;
      }

      function testEditorWithValidChallenge() {
        const resultDiv = document.getElementById("editorResult");
        resultDiv.innerHTML = `<div class="info">
                <h3>üîó Opening Editor with Valid Challenge</h3>
                <p>Should load the responsive-nav challenge successfully.</p>
                <p><a href="editor.html?challenge=responsive-nav" target="_blank">Open Editor with responsive-nav ‚Üí</a></p>
            </div>`;
      }

      // Auto-check localStorage on load
      window.addEventListener("load", () => {
        checkLocalStorage();
      });
    </script>
  </body>
</html>
