<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fix Challenge localStorage Issue</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        border-color: #bee5eb;
      }
      .warning {
        background-color: #fff3cd;
        border-color: #ffeaa7;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        cursor: pointer;
        border: none;
        border-radius: 4px;
        background-color: #007bff;
        color: white;
      }
      button:hover {
        background-color: #0056b3;
      }
      .btn-danger {
        background-color: #dc3545;
      }
      .btn-danger:hover {
        background-color: #c82333;
      }
      .btn-success {
        background-color: #28a745;
      }
      .btn-success:hover {
        background-color: #218838;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        overflow-x: auto;
        border-radius: 4px;
        border: 1px solid #e9ecef;
      }
      .status {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Fix Challenge localStorage Issue</h1>

      <div class="section warning">
        <h2>‚ö†Ô∏è Issue Description</h2>
        <p>
          <strong>Problem:</strong> The editor is trying to load a challenge
          called "Style Your HTML" which doesn't exist in the current system.
        </p>
        <p>
          <strong>Cause:</strong> This challenge name is likely stored in your
          browser's localStorage from a previous session.
        </p>
        <p>
          <strong>Solution:</strong> Clear the stored challenge data to fix the
          404 errors.
        </p>
      </div>

      <div class="section">
        <h2>üìä Current Status</h2>
        <button onclick="checkStatus()">Check Current Status</button>
        <div id="statusResult"></div>
      </div>

      <div class="section">
        <h2>üßπ Fix the Issue</h2>
        <button onclick="fixIssue()" class="btn-success">
          üîß Fix Challenge localStorage Issue
        </button>
        <button onclick="clearAllData()" class="btn-danger">
          üóëÔ∏è Clear All CodeQuest Data (Nuclear Option)
        </button>
        <div id="fixResult"></div>
      </div>

      <div class="section">
        <h2>‚úÖ Verify Fix</h2>
        <button onclick="verifyFix()">Test Editor (Should Work Now)</button>
        <button onclick="testValidChallenge()">
          Test with Valid Challenge
        </button>
        <div id="verifyResult"></div>
      </div>

      <div class="section info">
        <h2>üìã Available Challenges</h2>
        <p>After fixing, you can use these valid challenges:</p>
        <ul>
          <li>
            <strong>responsive-nav</strong> - Responsive Navigation Menu
            (Medium, 75 XP)
          </li>
          <li>
            <strong>contact-card</strong> - Contact Card Component (Easy, 50 XP)
          </li>
          <li>
            <strong>todo-app</strong> - Interactive Todo List (Hard, 100 XP)
          </li>
        </ul>
      </div>
    </div>

    <script>
      function checkStatus() {
        const resultDiv = document.getElementById("statusResult");

        const challengeData = localStorage.getItem(
          "codequest_current_challenge"
        );

        let html = "<h3>Current Status:</h3>";

        if (challengeData) {
          if (challengeData === "Style Your HTML") {
            html += `<div class="error">
                        <p class="status">‚ùå ISSUE FOUND</p>
                        <p>localStorage contains the problematic challenge: "<strong>${challengeData}</strong>"</p>
                        <p>This is causing the 404 errors in the editor.</p>
                    </div>`;
          } else {
            html += `<div class="warning">
                        <p class="status">‚ö†Ô∏è CHALLENGE STORED</p>
                        <p>localStorage contains challenge: "<strong>${challengeData}</strong>"</p>
                        <p>This might be valid, but if you're having issues, consider clearing it.</p>
                    </div>`;
          }
        } else {
          html += `<div class="success">
                    <p class="status">‚úÖ NO ISSUES FOUND</p>
                    <p>No challenge data in localStorage. The 404 error might be from another source.</p>
                </div>`;
        }

        // Check for other CodeQuest data
        const allKeys = Object.keys(localStorage).filter(
          (key) =>
            key.toLowerCase().includes("codequest") ||
            key.toLowerCase().includes("challenge")
        );

        if (allKeys.length > 0) {
          html += "<h4>Other CodeQuest Data:</h4><ul>";
          allKeys.forEach((key) => {
            const value = localStorage.getItem(key);
            html += `<li><strong>${key}:</strong> ${
              value
                ? value.substring(0, 50) + (value.length > 50 ? "..." : "")
                : "(empty)"
            }</li>`;
          });
          html += "</ul>";
        }

        resultDiv.innerHTML = html;
      }

      function fixIssue() {
        const resultDiv = document.getElementById("fixResult");

        try {
          const challengeData = localStorage.getItem(
            "codequest_current_challenge"
          );

          if (challengeData) {
            localStorage.removeItem("codequest_current_challenge");
            resultDiv.innerHTML = `<div class="success">
                        <h3>‚úÖ Issue Fixed!</h3>
                        <p>Removed problematic challenge: "<strong>${challengeData}</strong>"</p>
                        <p>The editor should now work without 404 errors.</p>
                        <p><strong>Next step:</strong> Test the editor to confirm the fix.</p>
                    </div>`;
          } else {
            resultDiv.innerHTML = `<div class="info">
                        <h3>‚ÑπÔ∏è No Issue Found</h3>
                        <p>No challenge data was found in localStorage.</p>
                        <p>The 404 error might be coming from another source.</p>
                    </div>`;
          }
        } catch (error) {
          resultDiv.innerHTML = `<div class="error">
                    <h3>‚ùå Error</h3>
                    <p>Could not clear localStorage: ${error.message}</p>
                </div>`;
        }
      }

      function clearAllData() {
        const resultDiv = document.getElementById("fixResult");

        if (
          !confirm(
            "This will clear ALL CodeQuest data including progress and settings. Are you sure?"
          )
        ) {
          return;
        }

        try {
          const keys = Object.keys(localStorage).filter(
            (key) =>
              key.toLowerCase().includes("codequest") ||
              key.toLowerCase().includes("challenge")
          );

          keys.forEach((key) => localStorage.removeItem(key));

          resultDiv.innerHTML = `<div class="success">
                    <h3>‚úÖ All Data Cleared</h3>
                    <p>Removed ${keys.length} items from localStorage:</p>
                    <ul>${keys.map((key) => `<li>${key}</li>`).join("")}</ul>
                    <p>CodeQuest has been completely reset.</p>
                </div>`;
        } catch (error) {
          resultDiv.innerHTML = `<div class="error">
                    <h3>‚ùå Error</h3>
                    <p>Could not clear localStorage: ${error.message}</p>
                </div>`;
        }
      }

      function verifyFix() {
        const resultDiv = document.getElementById("verifyResult");
        resultDiv.innerHTML = `<div class="info">
                <h3>üîó Testing Editor</h3>
                <p>Opening editor in a new tab. Check the browser console for any 404 errors.</p>
                <p><a href="editor.html" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">
                    ‚Üí Open Editor (Should Load Without Errors)
                </a></p>
                <p><small>If you still see 404 errors, try refreshing the editor page or clearing your browser cache.</small></p>
            </div>`;

        // Open in new tab
        window.open("editor.html", "_blank");
      }

      function testValidChallenge() {
        const resultDiv = document.getElementById("verifyResult");
        resultDiv.innerHTML = `<div class="info">
                <h3>üîó Testing with Valid Challenge</h3>
                <p>Opening editor with the "responsive-nav" challenge.</p>
                <p><a href="editor.html?challenge=responsive-nav" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">
                    ‚Üí Open Editor with Responsive Nav Challenge
                </a></p>
                <p><small>This should load the challenge requirements and starter code without any errors.</small></p>
            </div>`;

        // Open in new tab
        window.open("editor.html?challenge=responsive-nav", "_blank");
      }

      // Auto-check status on load
      window.addEventListener("load", () => {
        checkStatus();
      });
    </script>
  </body>
</html>
